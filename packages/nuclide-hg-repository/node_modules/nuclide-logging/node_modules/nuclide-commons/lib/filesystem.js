
/*
 * Copyright (c) 2015-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the license found in the LICENSE file in
 * the root directory of this source tree.
 */

/**
 * Searches upwards through the filesystem from pathToFile to find a file with
 *   fileName.
 * @param fileName The name of the file to find.
 * @param pathToDirectory Where to begin the search. Must be a path to a directory, not a
 *   file.
 * @return directory that contains the nearest file or null.
 */

var findNearestFile = _asyncToGenerator(function* (fileName, pathToDirectory) {
  // TODO(5586355): If this becomes a bottleneck, we should consider memoizing
  // this function. The downside would be that if someone added a closer file
  // with fileName to pathToFile (or deleted the one that was cached), then we
  // would have a bug. This would probably be pretty rare, though.
  var currentPath = path.resolve(pathToDirectory);
  do {
    var fileToFind = path.join(currentPath, fileName);
    var hasFile = yield exists(fileToFind);
    if (hasFile) {
      return currentPath;
    }

    if (isRoot(currentPath)) {
      return null;
    }
    currentPath = path.dirname(currentPath);
  } while (true);
});

/**
 * Runs the equivalent of `mkdir -p` with the given path.
 *
 * Like most implementations of mkdirp, if it fails, it is possible that
 * directories were created for some prefix of the given path.
 * @return true if the path was created; false if it already existed.
 */

var mkdirp = _asyncToGenerator(function* (filePath) {
  var isExistingDirectory = yield exists(filePath);
  if (isExistingDirectory) {
    return false;
  } else {
    return new Promise(function (resolve, reject) {
      mkdirpLib(filePath, function (err) {
        if (err) {
          reject(err);
        } else {
          resolve(true);
        }
      });
    });
  }
}

/**
 * Removes directories even if they are non-empty. Does not fail if the directory doesn't exist.
 */
);

var rmdir = _asyncToGenerator(function* (filePath) {
  return new Promise(function (resolve, reject) {
    rimraf(filePath, function (err) {
      if (err) {
        reject(err);
      } else {
        resolve();
      }
    });
  });
});

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { var callNext = step.bind(null, 'next'); var callThrow = step.bind(null, 'throw'); function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(callNext, callThrow); } } callNext(); }); }; }

var fs = require('fs');
var path = require('path');
var mkdirpLib = require('mkdirp');
var rimraf = require('rimraf');

function isRoot(filePath) {
  return path.dirname(filePath) === filePath;
}

/**
 * Create a temp directory with given prefix. The caller is responsible for cleaning up the
 *   drectory.
 * @param prefix optinal prefix for the temp directory name.
 * @return path to a temporary directory.
 */
function tempdir() {
  var prefix = arguments.length <= 0 || arguments[0] === undefined ? '' : arguments[0];

  return new Promise(function (resolve, reject) {
    require('temp').mkdir(prefix, function (err, dirPath) {
      if (err) {
        reject(err);
      } else {
        resolve(dirPath);
      }
    });
  });
}

/**
 * @return path to a temporary file. The caller is responsible for cleaning up
 *     the file.
 */
function tempfile(options) {
  return new Promise(function (resolve, reject) {
    require('temp').open(options, function (err, info) {
      if (err) {
        reject(err);
      } else {
        resolve(info.path);
      }
    });
  });
}

function exists(filePath) {
  return new Promise(function (resolve, reject) {
    fs.exists(filePath, resolve);
  });
}

var asyncFs = {
  exists: exists,
  findNearestFile: findNearestFile,
  isRoot: isRoot,
  mkdirp: mkdirp,
  rmdir: rmdir,
  tempdir: tempdir,
  tempfile: tempfile
};

['chmod', 'lstat', 'mkdir', 'readdir', 'readFile', 'readlink', 'realpath', 'rename', 'stat', 'symlink', 'unlink', 'writeFile'].forEach(function (methodName) {
  asyncFs[methodName] = function () {
    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    var method = fs[methodName];
    return new Promise(function (resolve, reject) {
      method.apply(fs, args.concat([function (err, result) {
        return err ? reject(err) : resolve(result);
      }]));
    });
  };
});

module.exports = asyncFs;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi92YXIvZm9sZGVycy94Zi9yc3BoNF9jNTczMTVyczU3eHhzZHNrcnhudjM2dDAvVC90bXBlbW0ySHVwdWJsaXNoX3BhY2thZ2VzL25wbS9udWNsaWRlLWNvbW1vbnMvbGliL2ZpbGVzeXN0ZW0uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsV0FBVyxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBOERHLGVBQWUscUJBQTlCLFdBQStCLFFBQWdCLEVBQUUsZUFBdUIsRUFBb0I7Ozs7O0FBSzFGLE1BQUksV0FBVyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7QUFDaEQsS0FBRztBQUNELFFBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBQ2xELFFBQUksT0FBTyxHQUFHLE1BQU0sTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ3ZDLFFBQUksT0FBTyxFQUFFO0FBQ1gsYUFBTyxXQUFXLENBQUM7S0FDcEI7O0FBRUQsUUFBSSxNQUFNLENBQUMsV0FBVyxDQUFDLEVBQUU7QUFDdkIsYUFBTyxJQUFJLENBQUM7S0FDYjtBQUNELGVBQVcsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0dBQ3pDLFFBQVEsSUFBSSxFQUFFO0NBQ2hCOzs7Ozs7Ozs7O0lBZWMsTUFBTSxxQkFBckIsV0FBc0IsUUFBZ0IsRUFBb0I7QUFDeEQsTUFBSSxtQkFBbUIsR0FBRyxNQUFNLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUNqRCxNQUFJLG1CQUFtQixFQUFFO0FBQ3ZCLFdBQU8sS0FBSyxDQUFDO0dBQ2QsTUFBTTtBQUNMLFdBQU8sSUFBSSxPQUFPLENBQUMsVUFBQyxPQUFPLEVBQUUsTUFBTSxFQUFLO0FBQ3RDLGVBQVMsQ0FBQyxRQUFRLEVBQUUsVUFBQyxHQUFHLEVBQUs7QUFDM0IsWUFBSSxHQUFHLEVBQUU7QUFDUCxnQkFBTSxDQUFDLEdBQUcs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cEMsUUFBSSxNQUFNLEdBQUcsRUFBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQzVCLFdBQU8sSUFBSSxPQUFPLENBQUMsVUFBQyxPQUFPLEVBQUUsTUFBTSxFQUFLO0FBQ3RDLFlBQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FDM0IsVUFBQyxHQUFHLEVBQUUsTUFBTTtlQUFLLEdBQUcsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQztPQUFBLENBQ3JELENBQUMsQ0FBQyxDQUFDO0tBQ0wsQ0FBQyxDQUFDO0dBQ0osQ0FBQztDQUNILENBQUMsQ0FBQzs7QUFFSCxNQUFNLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyIsImZpbGUiOiIvdmFyL2ZvbGRlcnMveGYvcnNwaDRfYzU3MzE1cnM1N3h4c2Rza3J4bnYzNnQwL1QvdG1wZW1tMkh1cHVibGlzaF9wYWNrYWdlcy9ucG0vbnVjbGlkZS1jb21tb25zL2xpYi9maWxlc3lzdGVtLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBiYWJlbCc7XG4vKiBAZmxvdyAqL1xuXG4vKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIGxpY2Vuc2UgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBpblxuICogdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKi9cblxudmFyIGZzID0gcmVxdWlyZSgnZnMnKTtcbnZhciBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xudmFyIG1rZGlycExpYiA9IHJlcXVpcmUoJ21rZGlycCcpO1xudmFyIHJpbXJhZiA9IHJlcXVpcmUoJ3JpbXJhZicpO1xuXG5mdW5jdGlvbiBpc1Jvb3QoZmlsZVBhdGg6IHN0cmluZyk6IGJvb2xlYW4ge1xuICByZXR1cm4gcGF0aC5kaXJuYW1lKGZpbGVQYXRoKSA9PT0gZmlsZVBhdGg7XG59XG5cbi8qKlxuICogQ3JlYXRlIGEgdGVtcCBkaXJlY3Rvcnkgd2l0aCBnaXZlbiBwcmVmaXguIFRoZSBjYWxsZXIgaXMgcmVzcG9uc2libGUgZm9yIGNsZWFuaW5nIHVwIHRoZVxuICogICBkcmVjdG9yeS5cbiAqIEBwYXJhbSBwcmVmaXggb3B0aW5hbCBwcmVmaXggZm9yIHRoZSB0ZW1wIGRpcmVjdG9yeSBuYW1lLlxuICogQHJldHVybiBwYXRoIHRvIGEgdGVtcG9yYXJ5IGRpcmVjdG9yeS5cbiAqL1xuZnVuY3Rpb24gdGVtcGRpcihwcmVmaXg9Jyc6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgcmVxdWlyZSgndGVtcCcpLm1rZGlyKHByZWZpeCwgKGVyciwgZGlyUGF0aCkgPT4ge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc29sdmUoZGlyUGF0aCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufVxuXG4vKipcbiAqIEByZXR1cm4gcGF0aCB0byBhIHRlbXBvcmFyeSBmaWxlLiBUaGUgY2FsbGVyIGlzIHJlc3BvbnNpYmxlIGZvciBjbGVhbmluZyB1cFxuICogICAgIHRoZSBmaWxlLlxuICovXG5mdW5jdGlvbiB0ZW1wZmlsZShvcHRpb25zOiBhbnkpOiBQcm9taXNlPHN0cmluZz4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIHJlcXVpcmUoJ3RlbXAnKS5vcGVuKG9wdGlvbnMsIChlcnIsIGluZm8pID0+IHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXNvbHZlKGluZm8ucGF0aCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufVxuXG4vKipcbiAqIFNlYXJjaGVzIHVwd2FyZHMgdGhyb3VnaCB0aGUgZmlsZXN5c3RlbSBmcm9tIHBhdGhUb0ZpbGUgdG8gZmluZCBhIGZpbGUgd2l0aFxuICogICBmaWxlTmFtZS5cbiAqIEBwYXJhbSBmaWxlTmFtZSBUaGUgbmFtZSBvZiB0aGUgZmlsZSB0byBmaW5kLlxuICogQHBhcmFtIHBhdGhUb0RpcmVjdG9yeSBXaGVyZSB0byBiZWdpbiB0aGUgc2VhcmNoLiBNdXN0IGJlIGEgcGF0aCB0byBhIGRpcmVjdG9yeSwgbm90IGFcbiAqICAgZmlsZS5cbiAqIEByZXR1cm4gZGlyZWN0b3J5IHRoYXQgY29udGFpbnMgdGhlIG5lYXJlc3QgZmlsZSBvciBudWxsLlxuICovXG5hc3luYyBmdW5jdGlvbiBmaW5kTmVhcmVzdEZpbGUoZmlsZU5hbWU6IHN0cmluZywgcGF0aFRvRGlyZWN0b3J5OiBzdHJpbmcpOiBQcm9taXNlPD9zdHJpbmc+IHtcbiAgLy8gVE9ETyg1NTg2MzU1KTogSWYgdGhpcyBiZWNvbWVzIGEgYm90dGxlbmVjaywgd2Ugc2hvdWxkIGNvbnNpZGVyIG1lbW9pemluZ1xuICAvLyB0aGlzIGZ1bmN0aW9uLiBUaGUgZG93bnNpZGUgd291bGQgYmUgdGhhdCBpZiBzb21lb25lIGFkZGVkIGEgY2xvc2VyIGZpbGVcbiAgLy8gd2l0aCBmaWxlTmFtZSB0byBwYXRoVG9GaWxlIChvciBkZWxldGVkIHRoZSBvbmUgdGhhdCB3YXMgY2FjaGVkKSwgdGhlbiB3ZVxuICAvLyB3b3VsZCBoYXZlIGEgYnVnLiBUaGlzIHdvdWxkIHByb2JhYmx5IGJlIHByZXR0eSByYXJlLCB0aG91Z2guXG4gIHZhciBjdXJyZW50UGF0aCA9IHBhdGgucmVzb2x2ZShwYXRoVG9EaXJlY3RvcnkpO1xuICBkbyB7XG4gICAgdmFyIGZpbGVUb0ZpbmQgPSBwYXRoLmpvaW4oY3VycmVudFBhdGgsIGZpbGVOYW1lKTtcbiAgICB2YXIgaGFzRmlsZSA9IGF3YWl0IGV4aXN0cyhmaWxlVG9GaW5kKTtcbiAgICBpZiAoaGFzRmlsZSkge1xuICAgICAgcmV0dXJuIGN1cnJlbnRQYXRoO1xuICAgIH1cblxuICAgIGlmIChpc1Jvb3QoY3VycmVudFBhdGgpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY3VycmVudFBhdGggPSBwYXRoLmRpcm5hbWUoY3VycmVudFBhdGgpO1xuICB9IHdoaWxlICh0cnVlKTtcbn1cblxuZnVuY3Rpb24gZXhpc3RzKGZpbGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBmcy5leGlzdHMoZmlsZVBhdGgsIHJlc29sdmUpO1xuICB9KTtcbn1cblxuLyoqXG4gKiBSdW5zIHRoZSBlcXVpdmFsZW50IG9mIGBta2RpciAtcGAgd2l0aCB0aGUgZ2l2ZW4gcGF0aC5cbiAqXG4gKiBMaWtlIG1vc3QgaW1wbGVtZW50YXRpb25zIG9mIG1rZGlycCwgaWYgaXQgZmFpbHMsIGl0IGlzIHBvc3NpYmxlIHRoYXRcbiAqIGRpcmVjdG9yaWVzIHdlcmUgY3JlYXRlZCBmb3Igc29tZSBwcmVmaXggb2YgdGhlIGdpdmVuIHBhdGguXG4gKiBAcmV0dXJuIHRydWUgaWYgdGhlIHBhdGggd2FzIGNyZWF0ZWQ7IGZhbHNlIGlmIGl0IGFscmVhZHkgZXhpc3RlZC5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gbWtkaXJwKGZpbGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgdmFyIGlzRXhpc3RpbmdEaXJlY3RvcnkgPSBhd2FpdCBleGlzdHMoZmlsZVBhdGgpO1xuICBpZiAoaXNFeGlzdGluZ0RpcmVjdG9yeSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgbWtkaXJwTGliKGZpbGVQYXRoLCAoZXJyKSA9PiB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxufVxuXG4vKipcbiAqIFJlbW92ZXMgZGlyZWN0b3JpZXMgZXZlbiBpZiB0aGV5IGFyZSBub24tZW1wdHkuIERvZXMgbm90IGZhaWwgaWYgdGhlIGRpcmVjdG9yeSBkb2Vzbid0IGV4aXN0LlxuICovXG5hc3luYyBmdW5jdGlvbiBybWRpcihmaWxlUGF0aDogc3RyaW5nKTogUHJvbWlzZSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgcmltcmFmKGZpbGVQYXRoLCAoZXJyKSA9PiB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn1cblxudmFyIGFzeW5jRnMgPSB7XG4gIGV4aXN0cyxcbiAgZmluZE5lYXJlc3RGaWxlLFxuICBpc1Jvb3QsXG4gIG1rZGlycCxcbiAgcm1kaXIsXG4gIHRlbXBkaXIsXG4gIHRlbXBmaWxlLFxufTtcblxuW1xuICAnY2htb2QnLFxuICAnbHN0YXQnLFxuICAnbWtkaXInLFxuICAncmVhZGRpcicsXG4gICdyZWFkRmlsZScsXG4gICdyZWFkbGluaycsXG4gICdyZWFscGF0aCcsXG4gICdyZW5hbWUnLFxuICAnc3RhdCcsXG4gICdzeW1saW5rJyxcbiAgJ3VubGluaycsXG4gICd3cml0ZUZpbGUnLFxuXS5mb3JFYWNoKChtZXRob2ROYW1lKSA9PiB7XG4gIGFzeW5jRnNbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbiguLi5hcmdzKSB7XG4gICAgdmFyIG1ldGhvZCA9IGZzW21ldGhvZE5hbWVdO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBtZXRob2QuYXBwbHkoZnMsIGFyZ3MuY29uY2F0KFtcbiAgICAgICAgKGVyciwgcmVzdWx0KSA9PiBlcnIgPyByZWplY3QoZXJyKSA6IHJlc29sdmUocmVzdWx0KVxuICAgICAgXSkpO1xuICAgIH0pO1xuICB9O1xufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gYXN5bmNGcztcbiJdfQ==
