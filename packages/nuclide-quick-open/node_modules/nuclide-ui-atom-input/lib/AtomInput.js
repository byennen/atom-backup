
/*
 * Copyright (c) 2015-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the license found in the LICENSE file in
 * the root directory of this source tree.
 */

var _require = require('atom');

var CompositeDisposable = _require.CompositeDisposable;

var React = require('react-for-atom');

var PropTypes = React.PropTypes;

/**
 * An input field rendered as an <atom-text-editor mini />.
 */
var AtomInput = React.createClass({
  displayName: 'AtomInput',

  propTypes: {
    disabled: PropTypes.bool,
    initialValue: PropTypes.string.isRequired,
    placeholderText: PropTypes.string,
    onFocus: PropTypes.func,
    onClick: PropTypes.func,
    onBlur: PropTypes.func,
    size: PropTypes.oneOf(['xs', 'sm', 'lg'])
  },

  getDefaultProps: function getDefaultProps() {
    return {
      disabled: false,
      initialValue: '',
      placeholderText: null,
      onClick: function onClick() {},
      onFocus: function onFocus() {},
      onBlur: function onBlur() {}
    };
  },

  getInitialState: function getInitialState() {
    return {
      value: this.props.initialValue
    };
  },

  componentDidMount: function componentDidMount() {
    var _this = this;

    this._disposables = new CompositeDisposable();

    // There does not appear to be any sort of infinite loop where calling
    // setState({value}) in response to onDidChange() causes another change
    // event.
    var textEditor = this.getTextEditor();
    this._disposables.add(textEditor.onDidChange(function () {
      _this.setState({ value: textEditor.getText() });
    }));
    var placeholderText = this.props.placeholderText;
    if (placeholderText !== null) {
      textEditor.setPlaceholderText(placeholderText);
    }
    if (this.props.disabled) {
      this._updateDisabledState(true);
    }
  },

  componentWillReceiveProps: function componentWillReceiveProps(nextProps) {
    if (nextProps.disabled !== this.props.disabled) {
      this._updateDisabledState(nextProps.disabled);
    }
  },

  componentWillUnmount: function componentWillUnmount() {
    // Note that destroy() is not part of TextEditor's public API.
    this.getTextEditor().destroy();

    if (this._disposables) {
      this._disposables.dispose();
      this._disposables = null;
    }
  },

  _updateDisabledState: function _updateDisabledState(isDisabled) {
    // Hack to set TextEditor to read-only mode, per https://github.com/atom/atom/issues/6880
    if (isDisabled) {
      this._getTextEditorElement().removeAttribute('tabindex');
    } else {
      this._getTextEditorElement().setAttribute('tabindex', '-1');
    }
  },

  render: function render() {
    var className;
    if (this.props.size) {
      className = 'atom-text-editor-' + this.props.size;
    }

    return React.createElement(
      'atom-text-editor',
      {
        className: className,
        mini: true,
        onClick: this.props.onClick,
        onFocus: this.props.onFocus,
        onBlur: this.props.onBlur },
      this.state.value
    );
  },

  getText: function getText() {
    return this.state.value;
  },

  setText: function setText(text) {
    this.getTextEditor().setText(text);
  },

  getTextEditor: function getTextEditor() {
    return this._getTextEditorElement().getModel();
  },

  onDidChange: function onDidChange(callback) {
    return this.getTextEditor().onDidChange(callback);
  },

  _getTextEditorElement: function _getTextEditorElement() {
    return React.findDOMNode(this);
  },

  focus: function focus() {
    this.getTextEditor().moveToEndOfLine();
    this._getTextEditorElement().focus();
  }
});

module.exports = AtomInput;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi92YXIvZm9sZGVycy94Zi9yc3BoNF9jNTczMTVyczU3eHhzZHNrcnhudjM2dDAvVC90bXBlbW0ySHVwdWJsaXNoX3BhY2thZ2VzL25wbS9udWNsaWRlLXVpLWF0b20taW5wdXQvbGliL0F0b21JbnB1dC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxXQUFXLENBQUM7Ozs7Ozs7Ozs7ZUFXZ0IsT0FBTyxDQUFDLE1BQU0sQ0FBQzs7SUFBdEMsbUJBQW1CLFlBQW5CLG1CQUFtQjs7QUFDeEIsSUFBSSxLQUFLLEdBQUcsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7O0lBRWpDLFNBQVMsR0FBSSxLQUFLLENBQWxCLFNBQVM7Ozs7O0FBS2QsSUFBSSxTQUFTLEdBQUcsS0FBSyxDQUFDLFdBQVcsQ0FBQzs7O0FBRWhDLFdBQVMsRUFBRTtBQUNULFlBQVEsRUFBRSxTQUFTLENBQUMsSUFBSTtBQUN4QixnQkFBWSxFQUFFLFNBQVMsQ0FBQyxNQUFNLENBQUMsVUFBVTtBQUN6QyxtQkFBZSxFQUFFLFNBQVMsQ0FBQyxNQUFNO0FBQ2pDLFdBQU8sRUFBRSxTQUFTLENBQUMsSUFBSTtBQUN2QixXQUFPLEVBQUUsU0FBUyxDQUFDLElBQUk7QUFDdkIsVUFBTSxFQUFFLFNBQVMsQ0FBQyxJQUFJO0FBQ3RCLFFBQUksRUFBRSxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztHQUMxQzs7QUFFRCxpQkFBZSxFQUFBLDJCQUFHO0FBQ2hCLFdBQU87QUFDTCxjQUFRLEVBQUUsS0FBSztBQUNmLGtCQUFZLEVBQUUsRUFBRTtBQUNoQixxQkFBZSxFQUFFLElBQUk7QUFDckIsYUFBTyxFQUFFLG1CQUFNLEVBQUU7QUFDakIsYUFBTyxFQUFFLG1CQUFNLEVBQUU7QUFDakIsWUFBTSxFQUFFLGtCQUFNLEVBQUU7S0FDakIsQ0FBQztHQUNIOztBQUVELGlCQUFlLEVBQUEsMkJBQUc7QUFDaEIsV0FBTztBQUNM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QUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0dBQ25EOztBQUVELHVCQUFxQixFQUFBLGlDQUFZO0FBQy9CLFdBQU8sS0FBSyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztHQUNoQzs7QUFFRCxPQUFLLEVBQUEsaUJBQUc7QUFDTixRQUFJLENBQUMsYUFBYSxFQUFFLENBQUMsZUFBZSxFQUFFLENBQUM7QUFDdkMsUUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUMsS0FBSyxFQUFFLENBQUM7R0FDdEM7Q0FDRixDQUFDLENBQUM7O0FBRUgsTUFBTSxDQUFDLE9BQU8sR0FBRyxTQUFTLENBQUMiLCJmaWxlIjoiL3Zhci9mb2xkZXJzL3hmL3JzcGg0X2M1NzMxNXJzNTd4eHNkc2tyeG52MzZ0MC9UL3RtcGVtbTJIdXB1Ymxpc2hfcGFja2FnZXMvbnBtL251Y2xpZGUtdWktYXRvbS1pbnB1dC9saWIvQXRvbUlucHV0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBiYWJlbCc7XG4vKiBAZmxvdyAqL1xuXG4vKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIGxpY2Vuc2UgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBpblxuICogdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKi9cblxudmFyIHtDb21wb3NpdGVEaXNwb3NhYmxlfSA9IHJlcXVpcmUoJ2F0b20nKTtcbnZhciBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0LWZvci1hdG9tJyk7XG5cbnZhciB7UHJvcFR5cGVzfSA9IFJlYWN0O1xuXG4vKipcbiAqIEFuIGlucHV0IGZpZWxkIHJlbmRlcmVkIGFzIGFuIDxhdG9tLXRleHQtZWRpdG9yIG1pbmkgLz4uXG4gKi9cbnZhciBBdG9tSW5wdXQgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG5cbiAgcHJvcFR5cGVzOiB7XG4gICAgZGlzYWJsZWQ6IFByb3BUeXBlcy5ib29sLFxuICAgIGluaXRpYWxWYWx1ZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIHBsYWNlaG9sZGVyVGV4dDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBvbkZvY3VzOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvbkNsaWNrOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvbkJsdXI6IFByb3BUeXBlcy5mdW5jLFxuICAgIHNpemU6IFByb3BUeXBlcy5vbmVPZihbJ3hzJywgJ3NtJywgJ2xnJ10pLFxuICB9LFxuXG4gIGdldERlZmF1bHRQcm9wcygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgZGlzYWJsZWQ6IGZhbHNlLFxuICAgICAgaW5pdGlhbFZhbHVlOiAnJyxcbiAgICAgIHBsYWNlaG9sZGVyVGV4dDogbnVsbCxcbiAgICAgIG9uQ2xpY2s6ICgpID0+IHt9LFxuICAgICAgb25Gb2N1czogKCkgPT4ge30sXG4gICAgICBvbkJsdXI6ICgpID0+IHt9LFxuICAgIH07XG4gIH0sXG5cbiAgZ2V0SW5pdGlhbFN0YXRlKCkge1xuICAgIHJldHVybiB7XG4gICAgICB2YWx1ZTogdGhpcy5wcm9wcy5pbml0aWFsVmFsdWUsXG4gICAgfTtcbiAgfSxcblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICB0aGlzLl9kaXNwb3NhYmxlcyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XG5cbiAgICAvLyBUaGVyZSBkb2VzIG5vdCBhcHBlYXIgdG8gYmUgYW55IHNvcnQgb2YgaW5maW5pdGUgbG9vcCB3aGVyZSBjYWxsaW5nXG4gICAgLy8gc2V0U3RhdGUoe3ZhbHVlfSkgaW4gcmVzcG9uc2UgdG8gb25EaWRDaGFuZ2UoKSBjYXVzZXMgYW5vdGhlciBjaGFuZ2VcbiAgICAvLyBldmVudC5cbiAgICB2YXIgdGV4dEVkaXRvciA9IHRoaXMuZ2V0VGV4dEVkaXRvcigpO1xuICAgIHRoaXMuX2Rpc3Bvc2FibGVzLmFkZCh0ZXh0RWRpdG9yLm9uRGlkQ2hhbmdlKCgpID0+IHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe3ZhbHVlOiB0ZXh0RWRpdG9yLmdldFRleHQoKX0pO1xuICAgIH0pKTtcbiAgICB2YXIgcGxhY2Vob2xkZXJUZXh0ID0gdGhpcy5wcm9wcy5wbGFjZWhvbGRlclRleHQ7XG4gICAgaWYgKHBsYWNlaG9sZGVyVGV4dCAhPT0gbnVsbCkge1xuICAgICAgdGV4dEVkaXRvci5zZXRQbGFjZWhvbGRlclRleHQocGxhY2Vob2xkZXJUZXh0KTtcbiAgICB9XG4gICAgaWYgKHRoaXMucHJvcHMuZGlzYWJsZWQpIHtcbiAgICAgIHRoaXMuX3VwZGF0ZURpc2FibGVkU3RhdGUodHJ1ZSk7XG4gICAgfVxuICB9LFxuXG4gIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgaWYgKG5leHRQcm9wcy5kaXNhYmxlZCAhPT0gdGhpcy5wcm9wcy5kaXNhYmxlZCkge1xuICAgICAgdGhpcy5fdXBkYXRlRGlzYWJsZWRTdGF0ZShuZXh0UHJvcHMuZGlzYWJsZWQpO1xuICAgIH1cbiAgfSxcblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAvLyBOb3RlIHRoYXQgZGVzdHJveSgpIGlzIG5vdCBwYXJ0IG9mIFRleHRFZGl0b3IncyBwdWJsaWMgQVBJLlxuICAgIHRoaXMuZ2V0VGV4dEVkaXRvcigpLmRlc3Ryb3koKTtcblxuICAgIGlmICh0aGlzLl9kaXNwb3NhYmxlcykge1xuICAgICAgdGhpcy5fZGlzcG9zYWJsZXMuZGlzcG9zZSgpO1xuICAgICAgdGhpcy5fZGlzcG9zYWJsZXMgPSBudWxsO1xuICAgIH1cbiAgfSxcblxuICBfdXBkYXRlRGlzYWJsZWRTdGF0ZShpc0Rpc2FibGVkOiBib29sZWFuKTogdm9pZCB7XG4gICAgLy8gSGFjayB0byBzZXQgVGV4dEVkaXRvciB0byByZWFkLW9ubHkgbW9kZSwgcGVyIGh0dHBzOi8vZ2l0aHViLmNvbS9hdG9tL2F0b20vaXNzdWVzLzY4ODBcbiAgICBpZiAoaXNEaXNhYmxlZCkge1xuICAgICAgdGhpcy5fZ2V0VGV4dEVkaXRvckVsZW1lbnQoKS5yZW1vdmVBdHRyaWJ1dGUoJ3RhYmluZGV4Jyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2dldFRleHRFZGl0b3JFbGVtZW50KCkuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICctMScpO1xuICAgIH1cbiAgfSxcblxuICByZW5kZXIoKTogUmVhY3RFbGVtZW50IHtcbiAgICB2YXIgY2xhc3NOYW1lO1xuICAgIGlmICh0aGlzLnByb3BzLnNpemUpIHtcbiAgICAgIGNsYXNzTmFtZSA9IGBhdG9tLXRleHQtZWRpdG9yLSR7dGhpcy5wcm9wcy5zaXplfWA7XG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxhdG9tLXRleHQtZWRpdG9yXG4gICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lfVxuICAgICAgICBtaW5pXG4gICAgICAgIG9uQ2xpY2s9e3RoaXMucHJvcHMub25DbGlja31cbiAgICAgICAgb25Gb2N1cz17dGhpcy5wcm9wcy5vbkZvY3VzfVxuICAgICAgICBvbkJsdXI9e3RoaXMucHJvcHMub25CbHVyfT5cbiAgICAgICAge3RoaXMuc3RhdGUudmFsdWV9XG4gICAgICA8L2F0b20tdGV4dC1lZGl0b3I+XG4gICAgKTtcbiAgfSxcblxuICBnZXRUZXh0KCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdGUudmFsdWU7XG4gIH0sXG5cbiAgc2V0VGV4dCh0ZXh0OiBzdHJpbmcpIHtcbiAgICB0aGlzLmdldFRleHRFZGl0b3IoKS5zZXRUZXh0KHRleHQpO1xuICB9LFxuXG4gIGdldFRleHRFZGl0b3IoKTogVGV4dEVkaXRvciB7XG4gICAgcmV0dXJuIHRoaXMuX2dldFRleHRFZGl0b3JFbGVtZW50KCkuZ2V0TW9kZWwoKTtcbiAgfSxcblxuICBvbkRpZENoYW5nZShjYWxsYmFjazogKCkgPT4gYW55KTogYXRvbSREaXNwb3NhYmxlIHtcbiAgICByZXR1cm4gdGhpcy5nZXRUZXh0RWRpdG9yKCkub25EaWRDaGFuZ2UoY2FsbGJhY2spO1xuICB9LFxuXG4gIF9nZXRUZXh0RWRpdG9yRWxlbWVudCgpOiBFbGVtZW50IHtcbiAgICByZXR1cm4gUmVhY3QuZmluZERPTU5vZGUodGhpcyk7XG4gIH0sXG5cbiAgZm9jdXMoKSB7XG4gICAgdGhpcy5nZXRUZXh0RWRpdG9yKCkubW92ZVRvRW5kT2ZMaW5lKCk7XG4gICAgdGhpcy5fZ2V0VGV4dEVkaXRvckVsZW1lbnQoKS5mb2N1cygpO1xuICB9LFxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gQXRvbUlucHV0O1xuIl19
