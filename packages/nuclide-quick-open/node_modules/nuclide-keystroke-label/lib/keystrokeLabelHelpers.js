
/*
 * Copyright (c) 2015-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the license found in the LICENSE file in
 * the root directory of this source tree.
 */

/*
 * adapted from https://github.com/atom/underscore-plus/blob/master/src/underscore-plus.coffee
 */

var _require = require('nuclide-commons');

var array = _require.array;

var MAC_MODIFIER_KEYMAP = {
  alt: '⌥',
  cmd: '⌘',
  ctrl: '⌃',
  down: '↓',
  enter: '⏎',
  left: '←',
  option: '⌥',
  right: '→',
  shift: '⇧',
  up: '↑'
};

var NON_MAC_MODIFIER_KEYMAP = {
  alt: 'Alt',
  cmd: 'Cmd',
  ctrl: 'Ctrl',
  down: 'Down',
  enter: 'Enter',
  left: 'Left',
  option: 'Alt',
  right: 'Right',
  shift: 'Shift',
  up: 'Up'
};

// Human key combos should always explicitly state the shift key. This map is a disambiguator.
// 'shift-version': 'no-shift-version'
var SHIFT_KEYMAP = {
  '_': '-',
  ':': ';',
  '?': '/',
  '"': '\'',
  '{': '[',
  '}': ']',
  '+': '=',
  '<': ',',
  '>': '.',
  '|': '\\',
  '~': '`'
};

var FN_KEY_RE = /f[0-9]{1,2}/;

function flatten(arr) {
  var flattened = [];
  arr.forEach(function (el) {
    if (Array.isArray(el)) {
      flattened = flattened.concat(flatten(el));
    } else {
      flattened.push(el);
    }
  });
  return flattened;
}

function capitalize(word) {
  var first = word[0] || '';
  var rest = word.slice(1);
  return first.toUpperCase() + rest;
}

function humanizeKey(key, platform) {
  if (!key) {
    return key;
  }
  var modifierKeyMap = platform === 'darwin' ? MAC_MODIFIER_KEYMAP : NON_MAC_MODIFIER_KEYMAP;
  if (modifierKeyMap[key]) {
    return modifierKeyMap[key];
  }
  if (key.length === 1) {
    if (SHIFT_KEYMAP[key]) {
      return [modifierKeyMap.shift, SHIFT_KEYMAP[key]];
    }
    var uppercase = key.toUpperCase();
    if (key === uppercase && uppercase !== key.toLowerCase()) {
      return [modifierKeyMap.shift, uppercase];
    }
    return uppercase;
  }
  if (FN_KEY_RE.test(key)) {
    return key.toUpperCase();
  }
  return platform === 'darwin' ? key : capitalize(key);
}

/** Humanize the keystroke according to platform conventions. This method
 * attempts to mirror the text the given keystroke would have if displayed in
 * a system menu.
 *
 * @param keystroke A String keystroke to humanize such as `ctrl-O`.
 * @param platform An optional String platform to humanize for (default: `process.platform`).
 * @return a humanized representation of the keystroke.
 */
function humanizeKeystroke(keystroke, platform) {
  if (!keystroke) {
    return keystroke;
  }
  platform = platform || process.platform;
  var separator = platform === 'darwin' ? '' : '+';
  var key, keys, splitKeystroke;
  var keystrokes = keystroke.split(' ');
  var humanizedKeystrokes = [];
  for (var i = 0; i < keystrokes.length; i++) {
    var currentKeystroke = keystrokes[i];
    var splitKeystroke = currentKeystroke.split('-');
    keys = [];
    for (var index = 0; index < splitKeystroke.length; index++) {
      key = splitKeystroke[index];
      if (key === '' && splitKeystroke[index - 1] === '') {
        key = '-';
      }
      if (key) {
        keys.push(humanizeKey(key, platform));
      }
    }
    keys = array.from(new Set(flatten(keys)));
    humanizedKeystrokes.push(keys.join(separator));
  }
  return humanizedKeystrokes.join(' ');
}

module.exports = {
  humanizeKeystroke: humanizeKeystroke
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi92YXIvZm9sZGVycy94Zi9yc3BoNF9jNTczMTVyczU3eHhzZHNrcnhudjM2dDAvVC90bXBlbW0ySHVwdWJsaXNoX3BhY2thZ2VzL25wbS9udWNsaWRlLWtleXN0cm9rZS1sYWJlbC9saWIva2V5c3Ryb2tlTGFiZWxIZWxwZXJzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFdBQVcsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7ZUFlRSxPQUFPLENBQUMsaUJBQWlCLENBQUM7O0lBQW5DLEtBQUssWUFBTCxLQUFLOztBQUVWLElBQUksbUJBQW1CLEdBQUc7QUFDeEIsS0FBRyxFQUFFLEdBQVE7QUFDYixLQUFHLEVBQUUsR0FBUTtBQUNiLE1BQUksRUFBRSxHQUFRO0FBQ2QsTUFBSSxFQUFFLEdBQVE7QUFDZCxPQUFLLEVBQUUsR0FBUTtBQUNmLE1BQUksRUFBRSxHQUFRO0FBQ2QsUUFBTSxFQUFFLEdBQVE7QUFDaEIsT0FBSyxFQUFFLEdBQVE7QUFDZixPQUFLLEVBQUUsR0FBUTtBQUNmLElBQUUsRUFBRSxHQUFRO0NBQ2IsQ0FBQzs7QUFFRixJQUFJLHVCQUF1QixHQUFHO0FBQzVCLEtBQUcsRUFBRSxLQUFLO0FBQ1YsS0FBRyxFQUFFLEtBQUs7QUFDVixNQUFJLEVBQUUsTUFBTTtBQUNaLE1BQUksRUFBRSxNQUFNO0FBQ1osT0FBSyxFQUFFLE9BQU87QUFDZCxNQUFJLEVBQUUsTUFBTTtBQUNaLFFBQU0sRUFBRSxLQUFLO0FBQ2IsT0FBSyxFQUFFLE9BQU87QUFDZCxPQUFLLEVBQUUsT0FBTztBQUNkLElBQUUsRUFBRSxJQUFJO0NBQ1QsQ0FBQzs7OztBQUlGLElBQUksWUFBWSxHQUFHO0FBQ2pCLEtBQUcsRUFBRSxHQUFHO0FBQ1IsS0FBRyxFQUFFLEdBQUc7QUFDUixLQUFHLEVBQUUsR0FBRztBQUNSLEtBQUcsRUFBRSxJQUFJO0FBQ1QsS0FBRyxFQUFFLEdBQUc7QUFDUixLQUFHLEVBQUUsR0FBRztBQUNSLEtBQUcsRUFBRSxHQUFHO0FBQ1IsS0FB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QUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3JDLFFBQUksY0FBYyxHQUFHLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUNqRCxRQUFJLEdBQUcsRUFBRSxDQUFDO0FBQ1YsU0FBSyxJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUUsS0FBSyxHQUFHLGNBQWMsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLEVBQUU7QUFDMUQsU0FBRyxHQUFHLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUM1QixVQUFJLEdBQUcsS0FBSyxFQUFFLElBQUksY0FBYyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUU7QUFDbEQsV0FBRyxHQUFHLEdBQUcsQ0FBQztPQUNYO0FBQ0QsVUFBSSxHQUFHLEVBQUU7QUFDUCxZQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQztPQUN2QztLQUNGO0FBQ0QsUUFBSSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUMxQyx1QkFBbUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO0dBQ2hEO0FBQ0QsU0FBTyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7Q0FDdEM7O0FBRUQsTUFBTSxDQUFDLE9BQU8sR0FBRztBQUNmLG1CQUFpQixFQUFqQixpQkFBaUI7Q0FDbEIsQ0FBQyIsImZpbGUiOiIvdmFyL2ZvbGRlcnMveGYvcnNwaDRfYzU3MzE1cnM1N3h4c2Rza3J4bnYzNnQwL1QvdG1wZW1tMkh1cHVibGlzaF9wYWNrYWdlcy9ucG0vbnVjbGlkZS1rZXlzdHJva2UtbGFiZWwvbGliL2tleXN0cm9rZUxhYmVsSGVscGVycy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2UgYmFiZWwnO1xuLyogQGZsb3cgKi9cblxuLypcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBsaWNlbnNlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgaW5cbiAqIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICovXG5cbi8qXG4gKiBhZGFwdGVkIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2F0b20vdW5kZXJzY29yZS1wbHVzL2Jsb2IvbWFzdGVyL3NyYy91bmRlcnNjb3JlLXBsdXMuY29mZmVlXG4gKi9cblxudmFyIHthcnJheX0gPSByZXF1aXJlKCdudWNsaWRlLWNvbW1vbnMnKTtcblxudmFyIE1BQ19NT0RJRklFUl9LRVlNQVAgPSB7XG4gIGFsdDogJ1xcdTIzMjUnLFxuICBjbWQ6ICdcXHUyMzE4JyxcbiAgY3RybDogJ1xcdTIzMDMnLFxuICBkb3duOiAnXFx1MjE5MycsXG4gIGVudGVyOiAnXFx1MjNjZScsXG4gIGxlZnQ6ICdcXHUyMTkwJyxcbiAgb3B0aW9uOiAnXFx1MjMyNScsXG4gIHJpZ2h0OiAnXFx1MjE5MicsXG4gIHNoaWZ0OiAnXFx1MjFlNycsXG4gIHVwOiAnXFx1MjE5MScsXG59O1xuXG52YXIgTk9OX01BQ19NT0RJRklFUl9LRVlNQVAgPSB7XG4gIGFsdDogJ0FsdCcsXG4gIGNtZDogJ0NtZCcsXG4gIGN0cmw6ICdDdHJsJyxcbiAgZG93bjogJ0Rvd24nLFxuICBlbnRlcjogJ0VudGVyJyxcbiAgbGVmdDogJ0xlZnQnLFxuICBvcHRpb246ICdBbHQnLFxuICByaWdodDogJ1JpZ2h0JyxcbiAgc2hpZnQ6ICdTaGlmdCcsXG4gIHVwOiAnVXAnLFxufTtcblxuLy8gSHVtYW4ga2V5IGNvbWJvcyBzaG91bGQgYWx3YXlzIGV4cGxpY2l0bHkgc3RhdGUgdGhlIHNoaWZ0IGtleS4gVGhpcyBtYXAgaXMgYSBkaXNhbWJpZ3VhdG9yLlxuLy8gJ3NoaWZ0LXZlcnNpb24nOiAnbm8tc2hpZnQtdmVyc2lvbidcbnZhciBTSElGVF9LRVlNQVAgPSB7XG4gICdfJzogJy0nLFxuICAnOic6ICc7JyxcbiAgJz8nOiAnLycsXG4gICdcIic6ICdcXCcnLFxuICAneyc6ICdbJyxcbiAgJ30nOiAnXScsXG4gICcrJzogJz0nLFxuICAnPCc6ICcsJyxcbiAgJz4nOiAnLicsXG4gICd8JzogJ1xcXFwnLFxuICAnfic6ICdgJyxcbn07XG5cbnZhciBGTl9LRVlfUkUgPSAvZlswLTldezEsMn0vO1xuXG5mdW5jdGlvbiBmbGF0dGVuKGFycjogQXJyYXkpOiBBcnJheSB7XG4gIHZhciBmbGF0dGVuZWQgPSBbXTtcbiAgYXJyLmZvckVhY2goZWwgPT4ge1xuICAgIGlmIChBcnJheS5pc0FycmF5KGVsKSkge1xuICAgICAgZmxhdHRlbmVkID0gZmxhdHRlbmVkLmNvbmNhdChmbGF0dGVuKGVsKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZsYXR0ZW5lZC5wdXNoKGVsKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gZmxhdHRlbmVkO1xufVxuXG5mdW5jdGlvbiBjYXBpdGFsaXplKHdvcmQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIHZhciBmaXJzdCA9IHdvcmRbMF0gfHwgJyc7XG4gIHZhciByZXN0ID0gd29yZC5zbGljZSgxKTtcbiAgcmV0dXJuIGZpcnN0LnRvVXBwZXJDYXNlKCkgKyByZXN0O1xufVxuXG5mdW5jdGlvbiBodW1hbml6ZUtleShrZXk6IHN0cmluZywgcGxhdGZvcm06ID9zdHJpbmcpOiBzdHJpbmcgfCBBcnJheTxzdHJpbmc+IHtcbiAgaWYgKCFrZXkpIHtcbiAgICByZXR1cm4ga2V5O1xuICB9XG4gIHZhciBtb2RpZmllcktleU1hcCA9IHBsYXRmb3JtID09PSAnZGFyd2luJyA/IE1BQ19NT0RJRklFUl9LRVlNQVAgOiBOT05fTUFDX01PRElGSUVSX0tFWU1BUDtcbiAgaWYgKG1vZGlmaWVyS2V5TWFwW2tleV0pIHtcbiAgICByZXR1cm4gbW9kaWZpZXJLZXlNYXBba2V5XTtcbiAgfVxuICBpZiAoa2V5Lmxlbmd0aCA9PT0gMSkge1xuICAgIGlmIChTSElGVF9LRVlNQVBba2V5XSkge1xuICAgICAgcmV0dXJuIFttb2RpZmllcktleU1hcC5zaGlmdCwgU0hJRlRfS0VZTUFQW2tleV1dO1xuICAgIH1cbiAgICB2YXIgdXBwZXJjYXNlID0ga2V5LnRvVXBwZXJDYXNlKCk7XG4gICAgaWYgKGtleSA9PT0gdXBwZXJjYXNlICYmIHVwcGVyY2FzZSAhPT0ga2V5LnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgIHJldHVybiBbbW9kaWZpZXJLZXlNYXAuc2hpZnQsIHVwcGVyY2FzZV07XG4gICAgfVxuICAgIHJldHVybiB1cHBlcmNhc2U7XG4gIH1cbiAgaWYgKEZOX0tFWV9SRS50ZXN0KGtleSkpIHtcbiAgICByZXR1cm4ga2V5LnRvVXBwZXJDYXNlKCk7XG4gIH1cbiAgcmV0dXJuIHBsYXRmb3JtID09PSAnZGFyd2luJyA/IGtleSA6IGNhcGl0YWxpemUoa2V5KTtcbn1cblxuLyoqIEh1bWFuaXplIHRoZSBrZXlzdHJva2UgYWNjb3JkaW5nIHRvIHBsYXRmb3JtIGNvbnZlbnRpb25zLiBUaGlzIG1ldGhvZFxuICogYXR0ZW1wdHMgdG8gbWlycm9yIHRoZSB0ZXh0IHRoZSBnaXZlbiBrZXlzdHJva2Ugd291bGQgaGF2ZSBpZiBkaXNwbGF5ZWQgaW5cbiAqIGEgc3lzdGVtIG1lbnUuXG4gKlxuICogQHBhcmFtIGtleXN0cm9rZSBBIFN0cmluZyBrZXlzdHJva2UgdG8gaHVtYW5pemUgc3VjaCBhcyBgY3RybC1PYC5cbiAqIEBwYXJhbSBwbGF0Zm9ybSBBbiBvcHRpb25hbCBTdHJpbmcgcGxhdGZvcm0gdG8gaHVtYW5pemUgZm9yIChkZWZhdWx0OiBgcHJvY2Vzcy5wbGF0Zm9ybWApLlxuICogQHJldHVybiBhIGh1bWFuaXplZCByZXByZXNlbnRhdGlvbiBvZiB0aGUga2V5c3Ryb2tlLlxuICovXG5mdW5jdGlvbiBodW1hbml6ZUtleXN0cm9rZShrZXlzdHJva2U6IHN0cmluZywgcGxhdGZvcm06ID9zdHJpbmcpOiBzdHJpbmcge1xuICBpZiAoIWtleXN0cm9rZSkge1xuICAgIHJldHVybiBrZXlzdHJva2U7XG4gIH1cbiAgcGxhdGZvcm0gPSBwbGF0Zm9ybSB8fCBwcm9jZXNzLnBsYXRmb3JtO1xuICB2YXIgc2VwYXJhdG9yID0gcGxhdGZvcm0gPT09ICdkYXJ3aW4nID8gJycgOiAnKyc7XG4gIHZhciBrZXksIGtleXMsIHNwbGl0S2V5c3Ryb2tlO1xuICB2YXIga2V5c3Ryb2tlcyA9IGtleXN0cm9rZS5zcGxpdCgnICcpO1xuICB2YXIgaHVtYW5pemVkS2V5c3Ryb2tlcyA9IFtdO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXN0cm9rZXMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgY3VycmVudEtleXN0cm9rZSA9IGtleXN0cm9rZXNbaV07XG4gICAgdmFyIHNwbGl0S2V5c3Ryb2tlID0gY3VycmVudEtleXN0cm9rZS5zcGxpdCgnLScpO1xuICAgIGtleXMgPSBbXTtcbiAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgc3BsaXRLZXlzdHJva2UubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBrZXkgPSBzcGxpdEtleXN0cm9rZVtpbmRleF07XG4gICAgICBpZiAoa2V5ID09PSAnJyAmJiBzcGxpdEtleXN0cm9rZVtpbmRleCAtIDFdID09PSAnJykge1xuICAgICAgICBrZXkgPSAnLSc7XG4gICAgICB9XG4gICAgICBpZiAoa2V5KSB7XG4gICAgICAgIGtleXMucHVzaChodW1hbml6ZUtleShrZXksIHBsYXRmb3JtKSk7XG4gICAgICB9XG4gICAgfVxuICAgIGtleXMgPSBhcnJheS5mcm9tKG5ldyBTZXQoZmxhdHRlbihrZXlzKSkpO1xuICAgIGh1bWFuaXplZEtleXN0cm9rZXMucHVzaChrZXlzLmpvaW4oc2VwYXJhdG9yKSk7XG4gIH1cbiAgcmV0dXJuIGh1bWFuaXplZEtleXN0cm9rZXMuam9pbignICcpO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgaHVtYW5pemVLZXlzdHJva2UsXG59O1xuIl19
