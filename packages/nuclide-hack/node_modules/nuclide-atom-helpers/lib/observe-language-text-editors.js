
/*
 * Copyright (c) 2015-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the license found in the LICENSE file in
 * the root directory of this source tree.
 */

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var _require = require('atom');

var CompositeDisposable = _require.CompositeDisposable;
var Disposable = _require.Disposable;

var _require2 = require('events');

var EventEmitter = _require2.EventEmitter;

var START_OBSERVING_TEXT_EDITOR_EVENT = 'start-observing-text-editor';
var STOP_OBSERVING_TEXT_EDITOR_EVENT = 'stop-observing-text-editor';

/**
 * Use this to perform an action on all text editors of the given grammar set.
 *
 * This exists as its own class to make it possible to reuse instances when
 * multiple callers observe on text editors with the same grammar scopes.
 */

var LanguageTextEditorsListener = (function () {
  function LanguageTextEditorsListener(grammarScopes) {
    var _this = this;

    _classCallCheck(this, LanguageTextEditorsListener);

    this._grammarScopes = grammarScopes;

    this._emitter = new EventEmitter();
    this._observedTextEditors = new Set();
    this._destroySubscriptionsMap = new Map();

    var _require3 = require('./main');

    var observeGrammarForTextEditors = _require3.observeGrammarForTextEditors;

    this._grammarSubscription = observeGrammarForTextEditors(function (textEditor, grammar) {
      var textEditorHasTheRightGrammar = _this._grammarScopes.has(grammar.scopeName);
      var isTextEditorObserved = _this._observedTextEditors.has(textEditor);
      if (textEditorHasTheRightGrammar && !isTextEditorObserved) {
        _this._emitter.emit(START_OBSERVING_TEXT_EDITOR_EVENT, textEditor);
        _this._observedTextEditors.add(textEditor);
      } else if (!textEditorHasTheRightGrammar && isTextEditorObserved) {
        _this._emitter.emit(STOP_OBSERVING_TEXT_EDITOR_EVENT, textEditor);
        _this._observedTextEditors['delete'](textEditor);
      }

      var destroySubscription = textEditor.onDidDestroy(function () {
        // When a text editor that we were observing is destroyed, we need to
        // do clean-up even if its grammar hasn't changed.
        if (_this._observedTextEditors.has(textEditor)) {
          _this._emitter.emit(STOP_OBSERVING_TEXT_EDITOR_EVENT, textEditor);
          _this._observedTextEditors['delete'](textEditor);
        }

        destroySubscription.dispose();
        _this._destroySubscriptionsMap['delete'](textEditor);
      });
      _this._destroySubscriptionsMap.set(textEditor, destroySubscription);
    });
  }

  _createClass(LanguageTextEditorsListener, [{
    key: 'observeLanguageTextEditors',
    value: function observeLanguageTextEditors(fn, cleanupFn) {
      var _this2 = this;

      // The event was already handled before `fn` was added to the emitter, so
      // we need to call it on all the existing editors.
      atom.workspace.getTextEditors().filter(function (textEditor) {
        return _this2._grammarScopes.has(textEditor.getGrammar().scopeName);
      })
      // We wrap `fn` instead of passing it directly to `.forEach` so it only
      // gets called with one arg (i.e. it matches the Flow annotation).
      .forEach(function (textEditor) {
        return fn(textEditor);
      });

      this._emitter.addListener(START_OBSERVING_TEXT_EDITOR_EVENT, fn);
      this._emitter.addListener(STOP_OBSERVING_TEXT_EDITOR_EVENT, cleanupFn);
      return new Disposable(function () {
        _this2._emitter.removeListener(START_OBSERVING_TEXT_EDITOR_EVENT, fn);
        _this2._emitter.removeListener(STOP_OBSERVING_TEXT_EDITOR_EVENT, cleanupFn);
      });
    }
  }, {
    key: 'dispose',
    value: function dispose() {
      this._emitter.removeAllListeners();
      this._observedTextEditors.clear();
      this._destroySubscriptionsMap.forEach(function (subscription) {
        return subscription.dispose();
      });
      this._destroySubscriptionsMap.clear();
      this._grammarSubscription.dispose();
    }
  }]);

  return LanguageTextEditorsListener;
})();

module.exports =
/**
 * Perform actions on text editors of a given language.
 *
 * @param grammarScopes The grammar scope names to watch for.
 * @param fn This is called once on every text editor that matches the grammars.
 * @param cleanupFn This is called when a text editor no longer matches the
 * grammars or is destroyed.
 */
function observeLanguageTextEditors(grammarScopes, fn, cleanupFn) {
  var subscriptions = new CompositeDisposable();
  var listener = new LanguageTextEditorsListener(new Set(grammarScopes));
  subscriptions.add(listener);
  subscriptions.add(listener.observeLanguageTextEditors(fn, cleanupFn || function () {}));
  return subscriptions;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi92YXIvZm9sZGVycy94Zi9yc3BoNF9jNTczMTVyczU3eHhzZHNrcnhudjM2dDAvVC90bXBlbW0ySHVwdWJsaXNoX3BhY2thZ2VzL25wbS9udWNsaWRlLWF0b20taGVscGVycy9saWIvb2JzZXJ2ZS1sYW5ndWFnZS10ZXh0LWVkaXRvcnMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsV0FBVyxDQUFDOzs7Ozs7Ozs7Ozs7OztlQVc0QixPQUFPLENBQUMsTUFBTSxDQUFDOztJQUFsRCxtQkFBbUIsWUFBbkIsbUJBQW1CO0lBQUUsVUFBVSxZQUFWLFVBQVU7O2dCQUNmLE9BQU8sQ0FBQyxRQUFRLENBQUM7O0lBQWpDLFlBQVksYUFBWixZQUFZOztBQUVqQixJQUFJLGlDQUFpQyxHQUFHLDZCQUE2QixDQUFDO0FBQ3RFLElBQUksZ0NBQWdDLEdBQUcsNEJBQTRCLENBQUM7Ozs7Ozs7OztJQVE5RCwyQkFBMkI7QUFDcEIsV0FEUCwyQkFBMkIsQ0FDbkIsYUFBMEIsRUFBRTs7OzBCQURwQywyQkFBMkI7O0FBRTdCLFFBQUksQ0FBQyxjQUFjLEdBQUcsYUFBYSxDQUFDOztBQUVwQyxRQUFJLENBQUMsUUFBUSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7QUFDbkMsUUFBSSxDQUFDLG9CQUFvQixHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7QUFDdEMsUUFBSSxDQUFDLHdCQUF3QixHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7O29CQUVMLE9BQU8sQ0FBQyxRQUFRLENBQUM7O1FBQWpELDRCQUE0QixhQUE1Qiw0QkFBNEI7O0FBQ2pDLFFBQUksQ0FBQyxvQkFBb0IsR0FBRyw0QkFBNEIsQ0FBQyxVQUFDLFVBQVUsRUFBRSxPQUFPLEVBQUs7QUFDaEYsVUFBSSw0QkFBNEIsR0FBRyxNQUFLLGNBQWMsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQzlFLFVBQUksb0JBQW9CLEdBQUcsTUFBSyxvQkFBb0IsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7QUFDckUsVUFBSSw0QkFBNEIsSUFBSSxDQUFDLG9CQUFvQixFQUFFO0FBQ3pELGNBQUssUUFBUSxDQUFDLElBQUksQ0FBQyxpQ0FBaUMsRUFBRSxVQUFVLENBQUMsQ0FBQztBQUNsRSxjQUFLLG9CQUFvQixDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQztPQUMzQyxNQUFNLElBQUksQ0FBQyw0QkFBNEIsSUFBSSxvQkFBb0IsRUFBRTtBQUNoRSxjQUFLLFFBQVEsQ0FBQyxJQUFJLENBQUMsZ0NBQWdDLEVBQUUsVUFBVSxDQUFDLENBQUM7QUFDakUsY0FBSyxvQkFBb0IsVUFBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO09BQzlDOztBQUVELFVBQUksbUJBQW1CLEdBQUcsVUFBVSxDQUFDLFlBQVksQ0FBQyxZQUFNOzs7QUFHdEQsWUFBSSxNQUFLLG9CQUFvQixDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsRUFBRTtBQUM3QyxnQkFBSyxRQUFRLENBQUMsSUFBSSxDQUFDLGdDQUFnQyxFQUFFLFVBQVUsQ0FBQyxDQUFDO0FBQ2pFLGdCQUFLLG9CQUFvQixVQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7U0FDOUM7O0FBRUQsMkJBQW1CLENBQUMsT0FBTyxFQUFFLENBQUM7QUFDOUIsY0FBSyx3QkFBd0IsVUFBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO09BQ2xELENBQUMsQ0FBQztBQUNILFlBQUssd0JBQXdCLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO0tBQ3BFLENBQUMsQ0FBQztHQUNKOztlQWpDRywyQkFBMkI7O1dBbUNMLG9DQUN0QixFQUFvQyxFQUNwQyxTQUEyQyxFQUFjOzs7OztBQUczRCxVQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsRUFBRSxDQUMxQixNQUFNLENBQUMsVUFBQSxVQUFVO2VBQUksT0FBSyxjQUFjLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxTQUFTLENBQUM7T0FBQSxDQUFDOzs7T0FHaEYsT0FBTyxDQUFDLFVBQUEsVUFBVTtlQUFJLEVBQUUsQ0FBQyxVQUFVLENBQUM7T0FBQSxDQUFDLENBQUM7O0FBRTNDLFVBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLGlDQUFpQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBQ2pFLFVBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLGdDQUFnQyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0FBQ3ZFLGFBQU8sSUFBSSxVQUFVLENBQUMsWUFBTTtBQUMxQixlQUFLLFFBQVEsQ0FBQyxjQUFjLENBQUMsaUNBQWlDLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFDcEUsZUFBSyxRQUFRLENBQUMsY0FBYyxDQUFDLGdDQUFnQyxFQUFFLFNBQVMsQ0FBQyxDQUFDO09BQzNFLENBQUMsQ0FBQztLQUNKOzs7V0FFTSxtQkFBUztBQUNkLFVBQUksQ0FBQyxRQUFRLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztBQUNuQyxVQUFJLENBQUMsb0JBQW9CLENBQUMsS0FBSyxFQUFFLENBQUM7QUFDbEMsVUFBSSxDQUFDLHdCQUF3QixDQUFDLE9BQU8sQ0FBQyxVQUFBLFlBQVk7ZUFBSSxZQUFZLENBQUMsT0FBTyxFQUFFO09BQUEsQ0FBQyxDQUFDO0FBQzlFLFVBQUksQ0FBQyx3QkFBd0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQztBQUN0QyxVQUFJLENBQUMsb0JBQW9CLENBQUMsT0FBTyxFQUFFLENBQUM7S0FDckM7OztTQTVERywyQkFBMkI7OztBQStEakMsTUFBTSxDQUFDLE9BQU87Ozs7Ozs7OztBQVNkLFNBQVMsMEJBQTBCLENBQy9CLGFBQTRCLEVBQzVCLEVBQW9DLEVBQ3BDLFNBQTRDLEVBQWM7QUFDNUQsTUFBSSxhQUFhLEdBQUcsSUFBSSxtQkFBbUIsRUFBRSxDQUFDO0FBQzlDLE1BQUksUUFBUSxHQUFHLElBQUksMkJBQTJCLENBQUMsSUFBSSxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztBQUN2RSxlQUFhLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzVCLGVBQWEsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLDBCQUEwQixDQUFDLEVBQUUsRUFBRSxTQUFTLElBQUssWUFBTSxFQUFFLEFBQUMsQ0FBQyxDQUFDLENBQUM7QUFDcEYsU0FBTyxhQUFhLENBQUM7Q0FDdEIsQ0FBQyIsImZpbGUiOiIvdmFyL2ZvbGRlcnMveGYvcnNwaDRfYzU3MzE1cnM1N3h4c2Rza3J4bnYzNnQwL1QvdG1wZW1tMkh1cHVibGlzaF9wYWNrYWdlcy9ucG0vbnVjbGlkZS1hdG9tLWhlbHBlcnMvbGliL29ic2VydmUtbGFuZ3VhZ2UtdGV4dC1lZGl0b3JzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBiYWJlbCc7XG4vKiBAZmxvdyAqL1xuXG4vKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIGxpY2Vuc2UgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBpblxuICogdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKi9cblxudmFyIHtDb21wb3NpdGVEaXNwb3NhYmxlLCBEaXNwb3NhYmxlfSA9IHJlcXVpcmUoJ2F0b20nKTtcbnZhciB7RXZlbnRFbWl0dGVyfSA9IHJlcXVpcmUoJ2V2ZW50cycpO1xuXG52YXIgU1RBUlRfT0JTRVJWSU5HX1RFWFRfRURJVE9SX0VWRU5UID0gJ3N0YXJ0LW9ic2VydmluZy10ZXh0LWVkaXRvcic7XG52YXIgU1RPUF9PQlNFUlZJTkdfVEVYVF9FRElUT1JfRVZFTlQgPSAnc3RvcC1vYnNlcnZpbmctdGV4dC1lZGl0b3InO1xuXG4vKipcbiAqIFVzZSB0aGlzIHRvIHBlcmZvcm0gYW4gYWN0aW9uIG9uIGFsbCB0ZXh0IGVkaXRvcnMgb2YgdGhlIGdpdmVuIGdyYW1tYXIgc2V0LlxuICpcbiAqIFRoaXMgZXhpc3RzIGFzIGl0cyBvd24gY2xhc3MgdG8gbWFrZSBpdCBwb3NzaWJsZSB0byByZXVzZSBpbnN0YW5jZXMgd2hlblxuICogbXVsdGlwbGUgY2FsbGVycyBvYnNlcnZlIG9uIHRleHQgZWRpdG9ycyB3aXRoIHRoZSBzYW1lIGdyYW1tYXIgc2NvcGVzLlxuICovXG5jbGFzcyBMYW5ndWFnZVRleHRFZGl0b3JzTGlzdGVuZXIge1xuICBjb25zdHJ1Y3RvcihncmFtbWFyU2NvcGVzOiBTZXQ8c3RyaW5nPikge1xuICAgIHRoaXMuX2dyYW1tYXJTY29wZXMgPSBncmFtbWFyU2NvcGVzO1xuXG4gICAgdGhpcy5fZW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICB0aGlzLl9vYnNlcnZlZFRleHRFZGl0b3JzID0gbmV3IFNldCgpO1xuICAgIHRoaXMuX2Rlc3Ryb3lTdWJzY3JpcHRpb25zTWFwID0gbmV3IE1hcCgpO1xuXG4gICAgdmFyIHtvYnNlcnZlR3JhbW1hckZvclRleHRFZGl0b3JzfSA9IHJlcXVpcmUoJy4vbWFpbicpO1xuICAgIHRoaXMuX2dyYW1tYXJTdWJzY3JpcHRpb24gPSBvYnNlcnZlR3JhbW1hckZvclRleHRFZGl0b3JzKCh0ZXh0RWRpdG9yLCBncmFtbWFyKSA9PiB7XG4gICAgICB2YXIgdGV4dEVkaXRvckhhc1RoZVJpZ2h0R3JhbW1hciA9IHRoaXMuX2dyYW1tYXJTY29wZXMuaGFzKGdyYW1tYXIuc2NvcGVOYW1lKTtcbiAgICAgIHZhciBpc1RleHRFZGl0b3JPYnNlcnZlZCA9IHRoaXMuX29ic2VydmVkVGV4dEVkaXRvcnMuaGFzKHRleHRFZGl0b3IpO1xuICAgICAgaWYgKHRleHRFZGl0b3JIYXNUaGVSaWdodEdyYW1tYXIgJiYgIWlzVGV4dEVkaXRvck9ic2VydmVkKSB7XG4gICAgICAgIHRoaXMuX2VtaXR0ZXIuZW1pdChTVEFSVF9PQlNFUlZJTkdfVEVYVF9FRElUT1JfRVZFTlQsIHRleHRFZGl0b3IpO1xuICAgICAgICB0aGlzLl9vYnNlcnZlZFRleHRFZGl0b3JzLmFkZCh0ZXh0RWRpdG9yKTtcbiAgICAgIH0gZWxzZSBpZiAoIXRleHRFZGl0b3JIYXNUaGVSaWdodEdyYW1tYXIgJiYgaXNUZXh0RWRpdG9yT2JzZXJ2ZWQpIHtcbiAgICAgICAgdGhpcy5fZW1pdHRlci5lbWl0KFNUT1BfT0JTRVJWSU5HX1RFWFRfRURJVE9SX0VWRU5ULCB0ZXh0RWRpdG9yKTtcbiAgICAgICAgdGhpcy5fb2JzZXJ2ZWRUZXh0RWRpdG9ycy5kZWxldGUodGV4dEVkaXRvcik7XG4gICAgICB9XG5cbiAgICAgIHZhciBkZXN0cm95U3Vic2NyaXB0aW9uID0gdGV4dEVkaXRvci5vbkRpZERlc3Ryb3koKCkgPT4ge1xuICAgICAgICAvLyBXaGVuIGEgdGV4dCBlZGl0b3IgdGhhdCB3ZSB3ZXJlIG9ic2VydmluZyBpcyBkZXN0cm95ZWQsIHdlIG5lZWQgdG9cbiAgICAgICAgLy8gZG8gY2xlYW4tdXAgZXZlbiBpZiBpdHMgZ3JhbW1hciBoYXNuJ3QgY2hhbmdlZC5cbiAgICAgICAgaWYgKHRoaXMuX29ic2VydmVkVGV4dEVkaXRvcnMuaGFzKHRleHRFZGl0b3IpKSB7XG4gICAgICAgICAgdGhpcy5fZW1pdHRlci5lbWl0KFNUT1BfT0JTRVJWSU5HX1RFWFRfRURJVE9SX0VWRU5ULCB0ZXh0RWRpdG9yKTtcbiAgICAgICAgICB0aGlzLl9vYnNlcnZlZFRleHRFZGl0b3JzLmRlbGV0ZSh0ZXh0RWRpdG9yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGRlc3Ryb3lTdWJzY3JpcHRpb24uZGlzcG9zZSgpO1xuICAgICAgICB0aGlzLl9kZXN0cm95U3Vic2NyaXB0aW9uc01hcC5kZWxldGUodGV4dEVkaXRvcik7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuX2Rlc3Ryb3lTdWJzY3JpcHRpb25zTWFwLnNldCh0ZXh0RWRpdG9yLCBkZXN0cm95U3Vic2NyaXB0aW9uKTtcbiAgICB9KTtcbiAgfVxuXG4gIG9ic2VydmVMYW5ndWFnZVRleHRFZGl0b3JzKFxuICAgICAgZm46ICh0ZXh0RWRpdG9yOiBUZXh0RWRpdG9yKSA9PiB2b2lkLFxuICAgICAgY2xlYW51cEZuOiAodGV4dEVkaXRvcjogVGV4dEVkaXRvcikgPT4gdm9pZCk6IERpc3Bvc2FibGUge1xuICAgIC8vIFRoZSBldmVudCB3YXMgYWxyZWFkeSBoYW5kbGVkIGJlZm9yZSBgZm5gIHdhcyBhZGRlZCB0byB0aGUgZW1pdHRlciwgc29cbiAgICAvLyB3ZSBuZWVkIHRvIGNhbGwgaXQgb24gYWxsIHRoZSBleGlzdGluZyBlZGl0b3JzLlxuICAgIGF0b20ud29ya3NwYWNlLmdldFRleHRFZGl0b3JzKClcbiAgICAgICAgLmZpbHRlcih0ZXh0RWRpdG9yID0+IHRoaXMuX2dyYW1tYXJTY29wZXMuaGFzKHRleHRFZGl0b3IuZ2V0R3JhbW1hcigpLnNjb3BlTmFtZSkpXG4gICAgICAgIC8vIFdlIHdyYXAgYGZuYCBpbnN0ZWFkIG9mIHBhc3NpbmcgaXQgZGlyZWN0bHkgdG8gYC5mb3JFYWNoYCBzbyBpdCBvbmx5XG4gICAgICAgIC8vIGdldHMgY2FsbGVkIHdpdGggb25lIGFyZyAoaS5lLiBpdCBtYXRjaGVzIHRoZSBGbG93IGFubm90YXRpb24pLlxuICAgICAgICAuZm9yRWFjaCh0ZXh0RWRpdG9yID0+IGZuKHRleHRFZGl0b3IpKTtcblxuICAgIHRoaXMuX2VtaXR0ZXIuYWRkTGlzdGVuZXIoU1RBUlRfT0JTRVJWSU5HX1RFWFRfRURJVE9SX0VWRU5ULCBmbik7XG4gICAgdGhpcy5fZW1pdHRlci5hZGRMaXN0ZW5lcihTVE9QX09CU0VSVklOR19URVhUX0VESVRPUl9FVkVOVCwgY2xlYW51cEZuKTtcbiAgICByZXR1cm4gbmV3IERpc3Bvc2FibGUoKCkgPT4ge1xuICAgICAgdGhpcy5fZW1pdHRlci5yZW1vdmVMaXN0ZW5lcihTVEFSVF9PQlNFUlZJTkdfVEVYVF9FRElUT1JfRVZFTlQsIGZuKTtcbiAgICAgIHRoaXMuX2VtaXR0ZXIucmVtb3ZlTGlzdGVuZXIoU1RPUF9PQlNFUlZJTkdfVEVYVF9FRElUT1JfRVZFTlQsIGNsZWFudXBGbik7XG4gICAgfSk7XG4gIH1cblxuICBkaXNwb3NlKCk6IHZvaWQge1xuICAgIHRoaXMuX2VtaXR0ZXIucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fb2JzZXJ2ZWRUZXh0RWRpdG9ycy5jbGVhcigpO1xuICAgIHRoaXMuX2Rlc3Ryb3lTdWJzY3JpcHRpb25zTWFwLmZvckVhY2goc3Vic2NyaXB0aW9uID0+IHN1YnNjcmlwdGlvbi5kaXNwb3NlKCkpO1xuICAgIHRoaXMuX2Rlc3Ryb3lTdWJzY3JpcHRpb25zTWFwLmNsZWFyKCk7XG4gICAgdGhpcy5fZ3JhbW1hclN1YnNjcmlwdGlvbi5kaXNwb3NlKCk7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPVxuLyoqXG4gKiBQZXJmb3JtIGFjdGlvbnMgb24gdGV4dCBlZGl0b3JzIG9mIGEgZ2l2ZW4gbGFuZ3VhZ2UuXG4gKlxuICogQHBhcmFtIGdyYW1tYXJTY29wZXMgVGhlIGdyYW1tYXIgc2NvcGUgbmFtZXMgdG8gd2F0Y2ggZm9yLlxuICogQHBhcmFtIGZuIFRoaXMgaXMgY2FsbGVkIG9uY2Ugb24gZXZlcnkgdGV4dCBlZGl0b3IgdGhhdCBtYXRjaGVzIHRoZSBncmFtbWFycy5cbiAqIEBwYXJhbSBjbGVhbnVwRm4gVGhpcyBpcyBjYWxsZWQgd2hlbiBhIHRleHQgZWRpdG9yIG5vIGxvbmdlciBtYXRjaGVzIHRoZVxuICogZ3JhbW1hcnMgb3IgaXMgZGVzdHJveWVkLlxuICovXG5mdW5jdGlvbiBvYnNlcnZlTGFuZ3VhZ2VUZXh0RWRpdG9ycyhcbiAgICBncmFtbWFyU2NvcGVzOiBBcnJheTxzdHJpbmc+LFxuICAgIGZuOiAodGV4dEVkaXRvcjogVGV4dEVkaXRvcikgPT4gdm9pZCxcbiAgICBjbGVhbnVwRm4/OiAodGV4dEVkaXRvcjogVGV4dEVkaXRvcikgPT4gdm9pZCk6IERpc3Bvc2FibGUge1xuICB2YXIgc3Vic2NyaXB0aW9ucyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XG4gIHZhciBsaXN0ZW5lciA9IG5ldyBMYW5ndWFnZVRleHRFZGl0b3JzTGlzdGVuZXIobmV3IFNldChncmFtbWFyU2NvcGVzKSk7XG4gIHN1YnNjcmlwdGlvbnMuYWRkKGxpc3RlbmVyKTtcbiAgc3Vic2NyaXB0aW9ucy5hZGQobGlzdGVuZXIub2JzZXJ2ZUxhbmd1YWdlVGV4dEVkaXRvcnMoZm4sIGNsZWFudXBGbiB8fCAoKCkgPT4ge30pKSk7XG4gIHJldHVybiBzdWJzY3JpcHRpb25zO1xufTtcbiJdfQ==
