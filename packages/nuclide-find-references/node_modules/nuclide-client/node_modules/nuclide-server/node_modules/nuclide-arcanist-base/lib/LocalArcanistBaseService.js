var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

/*
 * Copyright (c) 2015-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the license found in the LICENSE file in
 * the root directory of this source tree.
 */

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { var callNext = step.bind(null, 'next'); var callThrow = step.bind(null, 'throw'); function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(callNext, callThrow); } } callNext(); }); }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

'use babel';

var logger = require('nuclide-logging').getLogger();

var ArcanistBaseService = require('./ArcanistBaseService');

var ARC_CONFIG_FILE_NAME = '.arcconfig';

var LocalArcanistBaseService = (function (_ArcanistBaseService) {
  _inherits(LocalArcanistBaseService, _ArcanistBaseService);

  function LocalArcanistBaseService() {
    _classCallCheck(this, LocalArcanistBaseService);

    _get(Object.getPrototypeOf(LocalArcanistBaseService.prototype), 'constructor', this).call(this);
    this._arcConfigDirectoryMap = new Map();
    this._arcProjectMap = new Map();
  }

  _createClass(LocalArcanistBaseService, [{
    key: 'findArcConfigDirectory',
    value: _asyncToGenerator(function* (fileName) {
      if (!this._arcConfigDirectoryMap.has(fileName)) {
        var findNearestFile = require('nuclide-commons').findNearestFile;
        var result = yield findNearestFile(ARC_CONFIG_FILE_NAME, fileName);
        this._arcConfigDirectoryMap.set(fileName, result);
      }
      return this._arcConfigDirectoryMap.get(fileName);
    })
  }, {
    key: 'readArcConfig',
    value: _asyncToGenerator(function* (fileName) {
      var arcConfigDirectory = yield this.findArcConfigDirectory(fileName);
      if (!arcConfigDirectory) {
        return null;
      }
      if (!this._arcProjectMap.has(arcConfigDirectory)) {
        var path = require('path');
        var arcconfigFile = path.join(arcConfigDirectory, ARC_CONFIG_FILE_NAME);
        var result = JSON.parse((yield require('nuclide-commons').readFile(arcconfigFile)));
        this._arcProjectMap.set(arcConfigDirectory, result);
      }
      return this._arcProjectMap.get(arcConfigDirectory);
    })
  }, {
    key: 'findArcProjectIdOfPath',
    value: _asyncToGenerator(function* (fileName) {
      var project = yield this.readArcConfig(fileName);
      return project ? project['project_id'] : null;
    })
  }, {
    key: 'getProjectRelativePath',
    value: _asyncToGenerator(function* (fileName) {
      var arcPath = yield this.findArcConfigDirectory(fileName);
      var path = require('path');
      return arcPath && fileName ? path.relative(arcPath, fileName) : null;
    })
  }, {
    key: 'findDiagnostics',
    value: _asyncToGenerator(function* (pathToFile) {
      var cwd = yield this.findArcConfigDirectory(pathToFile);
      if (cwd === null) {
        return [];
      }

      var args = ['lint', '--output', 'json', pathToFile];
      var options = { 'cwd': cwd };

      var _require = require('nuclide-commons');

      var asyncExecute = _require.asyncExecute;

      var result = yield asyncExecute('arc', args, options);

      var json;
      try {
        json = JSON.parse(result.stdout);
      } catch (error) {
        logger.error('Error parsing `arc lint` JSON output', result.stdout);
        return [];
      }

      // json is an object where the keys are file paths that are relative to the
      // location of the .arcconfig file. There will be an entry in the map for
      // the file even if there were no lint errors.
      var key = require('path').relative(cwd, pathToFile);
      var lints = json[key];

      // TODO(7876450): For some reason, this does not work for particular values
      // of pathToFile.
      //
      // For now, we defend against this by returning the empty array.
      if (!lints) {
        return [];
      }

      return lints.map(function (lint) {
        // Choose an appropriate level based on lint['severity'].
        var severity = lint['severity'];
        var level = severity === 'error' ? 'Error' : 'Warning';

        var line = lint['line'];
        // Sometimes the linter puts in global errors on line 0, which will result
        // in a negative index. We offset those back to the first line.
        var col = Math.max(0, lint['char'] - 1);
        var row = Math.max(0, line - 1);

        return {
          type: level,
          text: lint['description'],
          filePath: pathToFile,
          row: row,
          col: col
        };
      });
    })
  }]);

  return LocalArcanistBaseService;
})(ArcanistBaseService);

module.exports = LocalArcanistBaseService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi92YXIvZm9sZGVycy94Zi9yc3BoNF9jNTczMTVyczU3eHhzZHNrcnhudjM2dDAvVC90bXBlbW0ySHVwdWJsaXNoX3BhY2thZ2VzL25wbS9udWNsaWRlLWFyY2FuaXN0LWJhc2UvbGliL0xvY2FsQXJjYW5pc3RCYXNlU2VydmljZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxXQUFXLENBQUM7O0FBYVosSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUMsU0FBUyxFQUFFLENBQUM7O0FBRXBELElBQUksbUJBQW1CLEdBQUcsT0FBTyxDQUFDLHVCQUF1QixDQUFDLENBQUM7O0FBRTNELElBQUksb0JBQW9CLEdBQUcsWUFBWSxDQUFDOztJQUVsQyx3QkFBd0I7WUFBeEIsd0JBQXdCOztBQUlqQixXQUpQLHdCQUF3QixHQUlkOzBCQUpWLHdCQUF3Qjs7QUFLMUIsK0JBTEUsd0JBQXdCLDZDQUtsQjtBQUNSLFFBQUksQ0FBQyxzQkFBc0IsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO0FBQ3hDLFFBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztHQUNqQzs7ZUFSRyx3QkFBd0I7OzZCQVVBLFdBQUMsUUFBb0IsRUFBd0I7QUFDdkUsVUFBSSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLEVBQUU7QUFDOUMsWUFBSSxlQUFlLEdBQUcsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUMsZUFBZSxDQUFDO0FBQ2pFLFlBQUksTUFBTSxHQUFHLE1BQU0sZUFBZSxDQUFDLG9CQUFvQixFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBQ25FLFlBQUksQ0FBQyxzQkFBc0IsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDO09BQ25EO0FBQ0QsYUFBTyxJQUFJLENBQUMsc0JBQXNCLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFD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SSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ2hDLFlBQUksS0FBSyxHQUFHLFFBQVEsS0FBSyxPQUFPLEdBQUcsT0FBTyxHQUFHLFNBQVMsQ0FBQzs7QUFFdkQsWUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDOzs7QUFHeEIsWUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0FBQ3hDLFlBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQzs7QUFFaEMsZUFBTztBQUNMLGNBQUksRUFBRSxLQUFLO0FBQ1gsY0FBSSxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUM7QUFDekIsa0JBQVEsRUFBRSxVQUFVO0FBQ3BCLGFBQUcsRUFBSCxHQUFHO0FBQ0gsYUFBRyxFQUFILEdBQUc7U0FDSixDQUFDO09BQ0gsQ0FBQyxDQUFDO0tBQ0o7OztTQWpHRyx3QkFBd0I7R0FBUyxtQkFBbUI7O0FBb0cxRCxNQUFNLENBQUMsT0FBTyxHQUFHLHdCQUF3QixDQUFDIiwiZmlsZSI6Ii92YXIvZm9sZGVycy94Zi9yc3BoNF9jNTczMTVyczU3eHhzZHNrcnhudjM2dDAvVC90bXBlbW0ySHVwdWJsaXNoX3BhY2thZ2VzL25wbS9udWNsaWRlLWFyY2FuaXN0LWJhc2UvbGliL0xvY2FsQXJjYW5pc3RCYXNlU2VydmljZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2UgYmFiZWwnO1xuLyogQGZsb3cgKi9cblxuLypcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBsaWNlbnNlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgaW5cbiAqIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICovXG5cbmltcG9ydCB0eXBlIHtOdWNsaWRlVXJpfSBmcm9tICdudWNsaWRlLXJlbW90ZS11cmknO1xuXG52YXIgbG9nZ2VyID0gcmVxdWlyZSgnbnVjbGlkZS1sb2dnaW5nJykuZ2V0TG9nZ2VyKCk7XG5cbnZhciBBcmNhbmlzdEJhc2VTZXJ2aWNlID0gcmVxdWlyZSgnLi9BcmNhbmlzdEJhc2VTZXJ2aWNlJyk7XG5cbnZhciBBUkNfQ09ORklHX0ZJTEVfTkFNRSA9ICcuYXJjY29uZmlnJztcblxuY2xhc3MgTG9jYWxBcmNhbmlzdEJhc2VTZXJ2aWNlIGV4dGVuZHMgQXJjYW5pc3RCYXNlU2VydmljZSB7XG4gIF9hcmNDb25maWdEaXJlY3RvcnlNYXA6IE1hcDxOdWNsaWRlVXJpLCA/TnVjbGlkZVVyaT47XG4gIF9hcmNQcm9qZWN0TWFwOiBNYXA8P051Y2xpZGVVcmksID9PYmplY3Q+O1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fYXJjQ29uZmlnRGlyZWN0b3J5TWFwID0gbmV3IE1hcCgpO1xuICAgIHRoaXMuX2FyY1Byb2plY3RNYXAgPSBuZXcgTWFwKCk7XG4gIH1cblxuICBhc3luYyBmaW5kQXJjQ29uZmlnRGlyZWN0b3J5KGZpbGVOYW1lOiBOdWNsaWRlVXJpKTogUHJvbWlzZTw/TnVjbGlkZVVyaT4ge1xuICAgIGlmICghdGhpcy5fYXJjQ29uZmlnRGlyZWN0b3J5TWFwLmhhcyhmaWxlTmFtZSkpIHtcbiAgICAgIHZhciBmaW5kTmVhcmVzdEZpbGUgPSByZXF1aXJlKCdudWNsaWRlLWNvbW1vbnMnKS5maW5kTmVhcmVzdEZpbGU7XG4gICAgICB2YXIgcmVzdWx0ID0gYXdhaXQgZmluZE5lYXJlc3RGaWxlKEFSQ19DT05GSUdfRklMRV9OQU1FLCBmaWxlTmFtZSk7XG4gICAgICB0aGlzLl9hcmNDb25maWdEaXJlY3RvcnlNYXAuc2V0KGZpbGVOYW1lLCByZXN1bHQpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fYXJjQ29uZmlnRGlyZWN0b3J5TWFwLmdldChmaWxlTmFtZSk7XG4gIH1cblxuICBhc3luYyByZWFkQXJjQ29uZmlnKGZpbGVOYW1lOiBOdWNsaWRlVXJpKTogUHJvbWlzZTw/T2JqZWN0PiB7XG4gICAgdmFyIGFyY0NvbmZpZ0RpcmVjdG9yeSA9IGF3YWl0IHRoaXMuZmluZEFyY0NvbmZpZ0RpcmVjdG9yeShmaWxlTmFtZSk7XG4gICAgaWYgKCFhcmNDb25maWdEaXJlY3RvcnkpIHtcbiAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgaWYgKCF0aGlzLl9hcmNQcm9qZWN0TWFwLmhhcyhhcmNDb25maWdEaXJlY3RvcnkpKSB7XG4gICAgICB2YXIgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbiAgICAgIHZhciBhcmNjb25maWdGaWxlID0gcGF0aC5qb2luKGFyY0NvbmZpZ0RpcmVjdG9yeSwgQVJDX0NPTkZJR19GSUxFX05BTUUpO1xuICAgICAgdmFyIHJlc3VsdCA9IEpTT04ucGFyc2UoXG4gICAgICAgIGF3YWl0IHJlcXVpcmUoJ251Y2xpZGUtY29tbW9ucycpLnJlYWRGaWxlKGFyY2NvbmZpZ0ZpbGUpKTtcbiAgICAgIHRoaXMuX2FyY1Byb2plY3RNYXAuc2V0KGFyY0NvbmZpZ0RpcmVjdG9yeSwgcmVzdWx0KTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX2FyY1Byb2plY3RNYXAuZ2V0KGFyY0NvbmZpZ0RpcmVjdG9yeSk7XG4gIH1cblxuICBhc3luYyBmaW5kQXJjUHJvamVjdElkT2ZQYXRoKGZpbGVOYW1lOiBOdWNsaWRlVXJpKTogUHJvbWlzZTw/c3RyaW5nPiB7XG4gICAgdmFyIHByb2plY3QgPSBhd2FpdCB0aGlzLnJlYWRBcmNDb25maWcoZmlsZU5hbWUpO1xuICAgIHJldHVybiBwcm9qZWN0ID8gcHJvamVjdFsncHJvamVjdF9pZCddIDogbnVsbDtcbiAgfVxuXG4gIGFzeW5jIGdldFByb2plY3RSZWxhdGl2ZVBhdGgoZmlsZU5hbWU6IE51Y2xpZGVVcmkpOiBQcm9taXNlPD9zdHJpbmc+IHtcbiAgICB2YXIgYXJjUGF0aCA9IGF3YWl0IHRoaXMuZmluZEFyY0NvbmZpZ0RpcmVjdG9yeShmaWxlTmFtZSk7XG4gICAgdmFyIHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG4gICAgcmV0dXJuIGFyY1BhdGggJiYgZmlsZU5hbWUgPyBwYXRoLnJlbGF0aXZlKGFyY1BhdGgsIGZpbGVOYW1lKSA6IG51bGw7XG4gIH1cblxuICBhc3luYyBmaW5kRGlhZ25vc3RpY3MocGF0aFRvRmlsZTogTnVjbGlkZVVyaSk6IFByb21pc2Uge1xuICAgIHZhciBjd2QgPSBhd2FpdCB0aGlzLmZpbmRBcmNDb25maWdEaXJlY3RvcnkocGF0aFRvRmlsZSk7XG4gICAgaWYgKGN3ZCA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIHZhciBhcmdzID0gWydsaW50JywgJy0tb3V0cHV0JywgJ2pzb24nLCBwYXRoVG9GaWxlXTtcbiAgICB2YXIgb3B0aW9ucyA9IHsnY3dkJzogY3dkfTtcbiAgICB2YXIge2FzeW5jRXhlY3V0ZX0gPSByZXF1aXJlKCdudWNsaWRlLWNvbW1vbnMnKTtcbiAgICB2YXIgcmVzdWx0ID0gYXdhaXQgYXN5bmNFeGVjdXRlKCdhcmMnLCBhcmdzLCBvcHRpb25zKTtcblxuICAgIHZhciBqc29uO1xuICAgIHRyeSB7XG4gICAgICBqc29uID0gSlNPTi5wYXJzZShyZXN1bHQuc3Rkb3V0KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBwYXJzaW5nIGBhcmMgbGludGAgSlNPTiBvdXRwdXQnLCByZXN1bHQuc3Rkb3V0KTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICAvLyBqc29uIGlzIGFuIG9iamVjdCB3aGVyZSB0aGUga2V5cyBhcmUgZmlsZSBwYXRocyB0aGF0IGFyZSByZWxhdGl2ZSB0byB0aGVcbiAgICAvLyBsb2NhdGlvbiBvZiB0aGUgLmFyY2NvbmZpZyBmaWxlLiBUaGVyZSB3aWxsIGJlIGFuIGVudHJ5IGluIHRoZSBtYXAgZm9yXG4gICAgLy8gdGhlIGZpbGUgZXZlbiBpZiB0aGVyZSB3ZXJlIG5vIGxpbnQgZXJyb3JzLlxuICAgIHZhciBrZXkgPSByZXF1aXJlKCdwYXRoJykucmVsYXRpdmUoY3dkLCBwYXRoVG9GaWxlKTtcbiAgICB2YXIgbGludHMgPSBqc29uW2tleV07XG5cbiAgICAvLyBUT0RPKDc4NzY0NTApOiBGb3Igc29tZSByZWFzb24sIHRoaXMgZG9lcyBub3Qgd29yayBmb3IgcGFydGljdWxhciB2YWx1ZXNcbiAgICAvLyBvZiBwYXRoVG9GaWxlLlxuICAgIC8vXG4gICAgLy8gRm9yIG5vdywgd2UgZGVmZW5kIGFnYWluc3QgdGhpcyBieSByZXR1cm5pbmcgdGhlIGVtcHR5IGFycmF5LlxuICAgIGlmICghbGludHMpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICByZXR1cm4gbGludHMubWFwKChsaW50KSA9PiB7XG4gICAgICAvLyBDaG9vc2UgYW4gYXBwcm9wcmlhdGUgbGV2ZWwgYmFzZWQgb24gbGludFsnc2V2ZXJpdHknXS5cbiAgICAgIHZhciBzZXZlcml0eSA9IGxpbnRbJ3NldmVyaXR5J107XG4gICAgICB2YXIgbGV2ZWwgPSBzZXZlcml0eSA9PT0gJ2Vycm9yJyA/ICdFcnJvcicgOiAnV2FybmluZyc7XG5cbiAgICAgIHZhciBsaW5lID0gbGludFsnbGluZSddO1xuICAgICAgLy8gU29tZXRpbWVzIHRoZSBsaW50ZXIgcHV0cyBpbiBnbG9iYWwgZXJyb3JzIG9uIGxpbmUgMCwgd2hpY2ggd2lsbCByZXN1bHRcbiAgICAgIC8vIGluIGEgbmVnYXRpdmUgaW5kZXguIFdlIG9mZnNldCB0aG9zZSBiYWNrIHRvIHRoZSBmaXJzdCBsaW5lLlxuICAgICAgdmFyIGNvbCA9IE1hdGgubWF4KDAsIGxpbnRbJ2NoYXInXSAtIDEpO1xuICAgICAgdmFyIHJvdyA9IE1hdGgubWF4KDAsIGxpbmUgLSAxKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogbGV2ZWwsXG4gICAgICAgIHRleHQ6IGxpbnRbJ2Rlc2NyaXB0aW9uJ10sXG4gICAgICAgIGZpbGVQYXRoOiBwYXRoVG9GaWxlLFxuICAgICAgICByb3csXG4gICAgICAgIGNvbCxcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBMb2NhbEFyY2FuaXN0QmFzZVNlcnZpY2U7XG4iXX0=
