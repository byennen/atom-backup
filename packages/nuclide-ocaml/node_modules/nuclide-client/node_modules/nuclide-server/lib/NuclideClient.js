var _slicedToArray = (function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i['return']) _i['return'](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError('Invalid attempt to destructure non-iterable instance'); } }; })();

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

/*
 * Copyright (c) 2015-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the license found in the LICENSE file in
 * the root directory of this source tree.
 */

/**
 * This code implements the NuclideFs client.  It uses the request module to
 * make XHR requests to the NuclideFS service.  It is a Promise based API.
 */

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { var callNext = step.bind(null, 'next'); var callThrow = step.bind(null, 'throw'); function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(callNext, callThrow); } } callNext(); }); }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

'use babel';

var fs = require('fs');
var extend = require('util')._extend;

var NuclideClient = (function () {
  function NuclideClient(id, eventbus) {
    var options = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];

    _classCallCheck(this, NuclideClient);

    this._id = id;
    this.eventbus = eventbus;
    this._options = options;
    this._searchProviders = {};
  }

  _createClass(NuclideClient, [{
    key: 'getID',
    value: function getID() {
      return this._id;
    }

    /**
     * Reads a file from remote FS
     *
     * @param path the path to the file to read
     * @param options set of options that are passed to fs.createReadStream.
     *
     * It returns promise that resolves to a Buffer with the file contents.
     */
  }, {
    key: 'readFile',
    value: _asyncToGenerator(function* (path, options) {
      return this.eventbus.callMethod(
      /*serviceName*/'fs',
      /*methodName*/'readFile',
      /*methodArgs*/[path, options]);
    })

    /**
     * Writes a file to the remote FS
     *
     * @param path the path to the file to read
     * @param data a node buffer of the data to write to file
     * @param options set of options that are passed to fs.createReadStream.
     *
     * It returns a void promise.
     */
  }, {
    key: 'writeFile',
    value: function writeFile(path, data, options) {
      return this.eventbus.callMethod(
      /*serviceName*/'fs',
      /*methodName*/'writeFile',
      /*methodArgs*/[path, options],
      /*extraOptions*/{ body: data, method: 'POST' });
    }

    /**
     * Creates a new, empty file on the remote FS.
     *
     * If no file (or directory) at the specified path exists, creates the parent
     * directories (if necessary) and then writes an empty file at the specified
     * path.
     *
     * @return A boolean indicating whether the file was created.
     */
  }, {
    key: 'newFile',
    value: function newFile(path) {
      return this.eventbus.callMethod(
      /*serviceName*/'fs',
      /*methodName*/'newFile',
      /*methodArgs*/[path],
      /*extraOptions*/{ method: 'POST', json: true });
    }

    /**
     * Returns an fs.Stats promise from remote FS
     *
     * @param path the path to the file/directory to get Stats for
     */
  }, {
    key: 'stat',
    value: _asyncToGenerator(function* (path) {
      var body = yield this.eventbus.callMethod(
      /*serviceName*/'fs',
      /*methodName*/'stat',
      /*methodArgs*/[path],
      /*extraOptions*/{ json: true });
      return createStats(body);
    })

    /**
     * Returns a promism that resolves to an array of
     * {file: 'name', stats: <fs.Stats>} from remote FS
     *
     * @param path the path to the directory to get entries for
     */
  }, {
    key: 'readdir',
    value: _asyncToGenerator(function* (path) {
      var body = yield this.eventbus.callMethod(
      /*serviceName*/'fs',
      /*methodName*/'readdir',
      /*methodArgs*/[path],
      /*extraOptions*/{ json: true });
      return body.map(function (entry) {
        return {
          file: entry.file,
          stats: createStats(entry.stats),
          isSymbolicLink: entry.isSymbolicLink
        };
      });
    })

    /**
     * Returns an fs.Stats promise from remote FS
     *
     * @param path the path to the file/directory to get Stats for
     *
     * Same as stats call above except it will return the stats for the
     * underlying file if a link is passed.
     */
  }, {
    key: 'lstat',
    value: _asyncToGenerator(function* (path) {
      var body = yield this.eventbus.callMethod(
      /*serviceName*/'fs',
      /*methodName*/'lstat',
      /*methodArgs*/[path],
      /*extraOptions*/{ json: true });
      return createStats(body);
    })

    /**
     * Checks for existence of a file/directory/link on a remote FS
     *
     * @param path the path to the file/directory to check for existence
     *
     * It returns promise that resolve to true if file exists, false otherwise.
     */
  }, {
    key: 'exists',
    value: function exists(path) {
      return this.eventbus.callMethod(
      /*serviceName*/'fs',
      /*methodName*/'exists',
      /*methodArgs*/[path],
      /*extraOptions*/{ json: true });
    }

    /**
     * Gets the real path of a file path.
     * It could be different than the given path if the file is a symlink
     * or exists in a symlinked directory.
     */
  }, {
    key: 'realpath',
    value: function realpath(path) {
      return this.eventbus.callMethod(
      /*serviceName*/'fs',
      /*methodName*/'realpath',
      /*methodArgs*/[path]);
    }

    /**
     * Rename a file or folder.
     */
  }, {
    key: 'rename',
    value: function rename(sourcePath, destinationPath) {
      return this.eventbus.callMethod(
      /*serviceName*/'fs',
      /*methodName*/'rename',
      /*methodArgs*/[sourcePath, destinationPath],
      /*extraOptions*/{ method: 'POST' });
    }

    /**
     * Creates a new directory with the given path.
     * Throws EEXIST error if the directory already exists.
     * Throws ENOENT if the path given is nested in a non-existing directory.
     */
  }, {
    key: 'mkdir',
    value: function mkdir(path) {
      return this.eventbus.callMethod(
      /*serviceName*/'fs',
      /*methodName*/'mkdir',
      /*methodArgs*/[path],
      /*extraOptions*/{ method: 'POST' });
    }

    /**
     * Runs the equivalent of `mkdir -p` with the given path.
     *
     * Like most implementations of mkdirp, if it fails, it is possible that
     * directories were created for some prefix of the given path.
     * @return true if the path was created; false if it already existed.
     */
  }, {
    key: 'mkdirp',
    value: function mkdirp(path) {
      return this.eventbus.callMethod(
      /*serviceName*/'fs',
      /*methodName*/'mkdirp',
      /*methodArgs*/[path],
      /*extraOptions*/{ method: 'POST', json: true });
    }

    /*
     * Removes directories even if they are non-empty. Does not fail if the directory doesn't exist.
     */
  }, {
    key: 'rmdir',
    value: function rmdir(path) {
      return this.eventbus.callMethod(
      /*serviceName*/'fs',
      /*methodName*/'rmdir',
      /*methodArgs*/[path],
      /*extraOptions*/{ method: 'POST', json: true });
    }

    /**
     * Removes files. Does not fail if the file doesn't exist.
     */
  }, {
    key: 'unlink',
    value: function unlink(path) {
      return this.eventbus.callMethod(
      /*serviceName*/'fs',
      /*methodName*/'unlink',
      /*methodArgs*/[path],
      /*extraOptions*/{ method: 'POST', json: true });
    }
  }, {
    key: 'findNearestFile',
    value: function findNearestFile(fileName, pathToDirectory) {
      return this.eventbus.callMethod(
      /*serviceName*/'fs',
      /*methodName*/'findNearestFile',
      /*methodArgs*/[fileName, pathToDirectory],
      /*extraOptions*/{ json: true });
    }

    /**
     * Make rpc call to service given serviceUri in form of `$serviceName/$methodName` and args as arguments list.
     */
  }, {
    key: 'makeRpc',
    value: function makeRpc(serviceUri, args, serviceOptions) {
      var _serviceUri$split = serviceUri.split('/');

      var _serviceUri$split2 = _slicedToArray(_serviceUri$split, 2);

      var serviceName = _serviceUri$split2[0];
      var methodName = _serviceUri$split2[1];

      return this.eventbus.callServiceFrameworkMethod(serviceName, methodName,
      /* methodArgs */args,
      /* serviceOptions */serviceOptions);
    }
  }, {
    key: 'registerEventListener',
    value: function registerEventListener(eventName, callback, serviceOptions) {
      return this.eventbus.registerEventListener(eventName, callback, serviceOptions);
    }

    /**
     * Searches the contents of `directory` for paths mathing `query`.
     */
  }, {
    key: 'searchDirectory',
    value: _asyncToGenerator(function* (directory, query) {
      return yield this.eventbus.callMethod(
      /*serviceName*/'search',
      /*methodName*/'directory',
      /*methodArgs*/[directory, query],
      /*extraOptions*/{ json: true });
    })

    /**
     * Returns the server version.
     */
  }, {
    key: 'version',
    value: function version() {
      return this.eventbus.callMethod(
      /*serviceName*/'server',
      /*methodName*/'version',
      /*methodArgs*/[],
      /*extraOptions*/{ method: 'POST', json: true });
    }

    /**
     * Returns the server version.
     */
  }, {
    key: 'shutdownServer',
    value: function shutdownServer() {
      return this.eventbus.callMethod(
      /*serviceName*/'server',
      /*methodName*/'shutdown',
      /*methodArgs*/[],
      /*extraOptions*/{ method: 'POST' });
    }
  }, {
    key: 'watchFile',
    value: _asyncToGenerator(function* (filePath) {
      var watcherId = yield this.eventbus.callMethod(
      /*serviceName*/'watcher',
      /*methodName*/'watchFile',
      /*methodArgs*/[filePath],
      /*extraOptions*/{ method: 'POST', json: true });
      return yield this.eventbus.consumeEventEmitter(watcherId, ['change', 'rename', 'delete']);
    })
  }, {
    key: 'watchDirectory',
    value: _asyncToGenerator(function* (directoryPath) {
      var watcherId = yield this.eventbus.callMethod(
      /*serviceName*/'watcher',
      /*methodName*/'watchDirectory',
      /*methodArgs*/[directoryPath],
      /*extraOptions*/{ method: 'POST', json: true });
      return yield this.eventbus.consumeEventEmitter(watcherId, ['change']);
    })
  }, {
    key: 'watchDirectoryRecursive',
    value: _asyncToGenerator(function* (directoryPath, handler) {
      var watchChannel = watchDirectoryChannel(directoryPath);
      yield this.eventbus.subscribeToChannel(watchChannel, handler);
      yield this.eventbus.callMethod(
      /*serviceName*/'watcher',
      /*methodName*/'watchDirectoryRecursive',
      /*methodArgs*/[directoryPath, watchChannel],
      /*extraOptions*/{ method: 'POST', json: true });
    })
  }, {
    key: 'unwatchFile',
    value: function unwatchFile(filePath) {
      return this.eventbus.callMethod(
      /*serviceName*/'watcher',
      /*methodName*/'unwatchFile',
      /*methodArgs*/[filePath],
      /*extraOptions*/{ method: 'POST', json: true });
    }
  }, {
    key: 'unwatchDirectory',
    value: function unwatchDirectory(directoryPath) {
      return this.eventbus.callMethod(
      /*serviceName*/'watcher',
      /*methodName*/'unwatchDirectory',
      /*methodArgs*/[directoryPath],
      /*extraOptions*/{ method: 'POST', json: true });
    }
  }, {
    key: 'unwatchDirectoryRecursive',
    value: function unwatchDirectoryRecursive(directoryPath) {
      return this.eventbus.callMethod(
      /*serviceName*/'watcher',
      /*methodName*/'unwatchDirectoryRecursive',
      /*methodArgs*/[directoryPath],
      /*extraOptions*/{ method: 'POST', json: true });
    }
  }, {
    key: 'doSearchQuery',
    value: function doSearchQuery(rootDirectory, provider, query) {
      return this.eventbus.callMethod(
      /*serviceName*/'search',
      /*methodName*/'query',
      /*methodArgs*/[rootDirectory, provider, query],
      /*extraOptions*/{ method: 'POST', json: true });
    }
  }, {
    key: 'getSearchProviders',
    value: _asyncToGenerator(function* (rootDirectory) {
      var providers = this._searchProviders[rootDirectory];
      if (providers) {
        return providers;
      }
      providers = yield this.eventbus.callMethod(
      /*serviceName*/'search',
      /*methodName*/'listProviders',
      /*methodArgs*/[rootDirectory],
      /*extraOptions*/{ method: 'POST', json: true });

      this._searchProviders[rootDirectory] = providers;

      return providers;
    })
  }, {
    key: 'getHackDiagnostics',
    value: function getHackDiagnostics() {
      var cwd = this._options.cwd;

      return this.eventbus.callMethod(
      /*serviceName*/'hack',
      /*methodName*/'getDiagnostics',
      /*methodArgs*/[{ cwd: cwd }],
      /*extraOptions*/{ method: 'POST', json: true });
    }
  }, {
    key: 'getHackCompletions',
    value: function getHackCompletions(query) {
      var cwd = this._options.cwd;

      return this.eventbus.callMethod(
      /*serviceName*/'hack',
      /*methodName*/'getCompletions',
      /*methodArgs*/[query, { cwd: cwd }],
      /*extraOptions*/{ method: 'POST', json: true });
    }
  }, {
    key: 'getHackDefinition',
    value: function getHackDefinition(query, symbolType) {
      var cwd = this._options.cwd;

      return this.eventbus.callMethod(
      /*serviceName*/'hack',
      /*methodName*/'getDefinition',
      /*methodArgs*/[query, symbolType, { cwd: cwd }],
      /*extraOptions*/{ method: 'POST', json: true });
    }
  }, {
    key: 'getHackDependencies',
    value: function getHackDependencies(dependenciesInfo) {
      var cwd = this._options.cwd;

      return this.eventbus.callMethod(
      /*serviceName*/'hack',
      /*methodName*/'getDependencies',
      /*methodArgs*/[dependenciesInfo, { cwd: cwd }],
      /*extraOptions*/{ method: 'POST', json: true });
    }
  }, {
    key: 'getHackSearchResults',
    value: function getHackSearchResults(search, filterTypes, searchPostfix) {
      var cwd = this._options.cwd;

      return this.eventbus.callMethod(
      /*serviceName*/'hack',
      /*methodName*/'getSearchResults',
      /*methodArgs*/[search, filterTypes, searchPostfix, { cwd: cwd }],
      /*extraOptions*/{ method: 'POST', json: true });
    }
  }, {
    key: 'getHackReferences',
    value: function getHackReferences(query) {
      var cwd = this._options.cwd;

      return this.eventbus.callMethod(
      /*serviceName*/'hack',
      /*methodName*/'getReferences',
      /*methodArgs*/[query, { cwd: cwd }],
      /*extraOptions*/{ method: 'POST', json: true });
    }
  }, {
    key: 'isHackClientAvailable',
    value: function isHackClientAvailable() {
      return this.eventbus.callMethod(
      /*serviceName*/'hack',
      /*methodName*/'isClientAvailable',
      /*methodArgs*/[],
      /*extraOptions*/{ method: 'POST', json: true });
    }
  }, {
    key: 'close',
    value: function close() {
      if (this.eventbus) {
        this.eventbus.close();
        this.eventbus = null;
      }
    }
  }]);

  return NuclideClient;
})();

function createStats(jsonStats) {
  var stats = new fs.Stats();

  stats.dev = jsonStats.dev;
  stats.mode = jsonStats.mode;
  stats.nlink = jsonStats.nlink;
  stats.uid = jsonStats.uid;
  stats.gid = jsonStats.gid;
  stats.rdev = jsonStats.rdev;
  stats.blksize = jsonStats.blksize;
  stats.ino = jsonStats.ino;
  stats.size = jsonStats.size;
  stats.blocks = jsonStats.blocks;
  stats.atime = new Date(jsonStats.atime);
  stats.mtime = new Date(jsonStats.mtime);
  stats.ctime = new Date(jsonStats.ctime);

  if (jsonStats.birthtime) {
    stats.birthtime = new Date(jsonStats.birthtime);
  }

  return stats;
}

module.exports = NuclideClient;

function watchDirectoryChannel(directoryPath) {
  return 'watch' + directoryPath;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi92YXIvZm9sZGVycy94Zi9yc3BoNF9jNTczMTVyczU3eHhzZHNrcnhudjM2dDAvVC90bXBlbW0ySHVwdWJsaXNoX3BhY2thZ2VzL25wbS9udWNsaWRlLXNlcnZlci9saWIvTnVjbGlkZUNsaWVudC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxXQUFXLENBQUM7O0FBa0JaLElBQUksRUFBRSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUN2QixJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDOztJQU8vQixhQUFhO0FBQ04sV0FEUCxhQUFhLENBQ0wsRUFBVSxFQUFFLFFBQTBCLEVBQXVDO1FBQXJDLE9BQThCLHlEQUFHLEVBQUU7OzBCQURuRixhQUFhOztBQUVmLFFBQUksQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDO0FBQ2QsUUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7QUFDekIsUUFBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUM7QUFDeEIsUUFBSSxDQUFDLGdCQUFnQixHQUFHLEVBQUUsQ0FBQztHQUM1Qjs7ZUFORyxhQUFhOztXQVFaLGlCQUFHO0FBQ04sYUFBTyxJQUFJLENBQUMsR0FBRyxDQUFDO0tBQ2pCOzs7Ozs7Ozs7Ozs7NkJBVWEsV0FBQyxJQUFZLEVBQUUsT0FBWSxFQUFtQjtBQUMxRCxhQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVTtxQkFDYixJQUFJO29CQUNMLFVBQVU7b0JBQ1YsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQy9CLENBQUM7S0FDSDs7Ozs7Ozs7Ozs7OztXQVdRLG1CQUFDLElBQVksRUFBRSxJQUFZLEVBQUUsT0FBWSxFQUFpQjtBQUNqRSxhQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVTtxQkFDYixJQUFJO29CQUNMLFdBQVc7b0JBQ1gsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDO3NCQUNi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QztBQUMxQixPQUFLLENBQUMsR0FBRyxHQUFHLFNBQVMsQ0FBQyxHQUFHLENBQUM7QUFDMUIsT0FBSyxDQUFDLElBQUksR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDO0FBQzVCLE9BQUssQ0FBQyxPQUFPLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQztBQUNsQyxPQUFLLENBQUMsR0FBRyxHQUFHLFNBQVMsQ0FBQyxHQUFHLENBQUM7QUFDMUIsT0FBSyxDQUFDLElBQUksR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDO0FBQzVCLE9BQUssQ0FBQyxNQUFNLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQztBQUNoQyxPQUFLLENBQUMsS0FBSyxHQUFHLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUN4QyxPQUFLLENBQUMsS0FBSyxHQUFHLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUN4QyxPQUFLLENBQUMsS0FBSyxHQUFHLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQzs7QUFFeEMsTUFBSSxTQUFTLENBQUMsU0FBUyxFQUFFO0FBQ3ZCLFNBQUssQ0FBQyxTQUFTLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0dBQ2pEOztBQUVELFNBQU8sS0FBSyxDQUFDO0NBQ2Q7O0FBRUQsTUFBTSxDQUFDLE9BQU8sR0FBRyxhQUFhLENBQUM7O0FBRS9CLFNBQVMscUJBQXFCLENBQUMsYUFBcUIsRUFBRTtBQUNwRCxTQUFPLE9BQU8sR0FBRyxhQUFhLENBQUM7Q0FDaEMiLCJmaWxlIjoiL3Zhci9mb2xkZXJzL3hmL3JzcGg0X2M1NzMxNXJzNTd4eHNkc2tyeG52MzZ0MC9UL3RtcGVtbTJIdXB1Ymxpc2hfcGFja2FnZXMvbnBtL251Y2xpZGUtc2VydmVyL2xpYi9OdWNsaWRlQ2xpZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBiYWJlbCc7XG4vKiBAZmxvdyAqL1xuXG4vKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIGxpY2Vuc2UgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBpblxuICogdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKi9cblxuLyoqXG4gKiBUaGlzIGNvZGUgaW1wbGVtZW50cyB0aGUgTnVjbGlkZUZzIGNsaWVudC4gIEl0IHVzZXMgdGhlIHJlcXVlc3QgbW9kdWxlIHRvXG4gKiBtYWtlIFhIUiByZXF1ZXN0cyB0byB0aGUgTnVjbGlkZUZTIHNlcnZpY2UuICBJdCBpcyBhIFByb21pc2UgYmFzZWQgQVBJLlxuICovXG5cbmltcG9ydCB0eXBlIHtIYWNrUmVmZXJlbmNlfSBmcm9tICdudWNsaWRlLWhhY2stY29tbW9uJztcbmltcG9ydCB0eXBlIEZpbGVXaXRoU3RhdHMgZnJvbSAnLi9OdWNsaWRlRnNTZXJ2aWNlJztcbnZhciBmcyA9IHJlcXVpcmUoJ2ZzJyk7XG52YXIgZXh0ZW5kID0gcmVxdWlyZSgndXRpbCcpLl9leHRlbmQ7XG5cbnR5cGUgRXhlY1Jlc3VsdCA9IHtlcnJvcjogP0Vycm9yOyBzdGRvdXQ6IHN0cmluZzsgc3RkZXJyOiBzdHJpbmd9O1xudHlwZSBOdWNsaWRlQ2xpZW50T3B0aW9ucyA9IHtcbiAgY3dkOiA/c3RyaW5nO1xufTtcblxuY2xhc3MgTnVjbGlkZUNsaWVudCB7XG4gIGNvbnN0cnVjdG9yKGlkOiBzdHJpbmcsIGV2ZW50YnVzIDogTnVjbGlkZUV2ZW50YnVzLCBvcHRpb25zOiA/TnVjbGlkZUNsaWVudE9wdGlvbnMgPSB7fSkge1xuICAgIHRoaXMuX2lkID0gaWQ7XG4gICAgdGhpcy5ldmVudGJ1cyA9IGV2ZW50YnVzO1xuICAgIHRoaXMuX29wdGlvbnMgPSBvcHRpb25zO1xuICAgIHRoaXMuX3NlYXJjaFByb3ZpZGVycyA9IHt9O1xuICB9XG5cbiAgZ2V0SUQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2lkO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlYWRzIGEgZmlsZSBmcm9tIHJlbW90ZSBGU1xuICAgKlxuICAgKiBAcGFyYW0gcGF0aCB0aGUgcGF0aCB0byB0aGUgZmlsZSB0byByZWFkXG4gICAqIEBwYXJhbSBvcHRpb25zIHNldCBvZiBvcHRpb25zIHRoYXQgYXJlIHBhc3NlZCB0byBmcy5jcmVhdGVSZWFkU3RyZWFtLlxuICAgKlxuICAgKiBJdCByZXR1cm5zIHByb21pc2UgdGhhdCByZXNvbHZlcyB0byBhIEJ1ZmZlciB3aXRoIHRoZSBmaWxlIGNvbnRlbnRzLlxuICAgKi9cbiAgYXN5bmMgcmVhZEZpbGUocGF0aDogc3RyaW5nLCBvcHRpb25zPzoge30pOiBQcm9taXNlPEJ1ZmZlcj4ge1xuICAgIHJldHVybiB0aGlzLmV2ZW50YnVzLmNhbGxNZXRob2QoXG4gICAgICAvKnNlcnZpY2VOYW1lKi8gJ2ZzJyxcbiAgICAgIC8qbWV0aG9kTmFtZSovICdyZWFkRmlsZScsXG4gICAgICAvKm1ldGhvZEFyZ3MqLyBbcGF0aCwgb3B0aW9uc11cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFdyaXRlcyBhIGZpbGUgdG8gdGhlIHJlbW90ZSBGU1xuICAgKlxuICAgKiBAcGFyYW0gcGF0aCB0aGUgcGF0aCB0byB0aGUgZmlsZSB0byByZWFkXG4gICAqIEBwYXJhbSBkYXRhIGEgbm9kZSBidWZmZXIgb2YgdGhlIGRhdGEgdG8gd3JpdGUgdG8gZmlsZVxuICAgKiBAcGFyYW0gb3B0aW9ucyBzZXQgb2Ygb3B0aW9ucyB0aGF0IGFyZSBwYXNzZWQgdG8gZnMuY3JlYXRlUmVhZFN0cmVhbS5cbiAgICpcbiAgICogSXQgcmV0dXJucyBhIHZvaWQgcHJvbWlzZS5cbiAgICovXG4gIHdyaXRlRmlsZShwYXRoOiBzdHJpbmcsIGRhdGE6IEJ1ZmZlciwgb3B0aW9ucz86IHt9KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRidXMuY2FsbE1ldGhvZChcbiAgICAgIC8qc2VydmljZU5hbWUqLyAnZnMnLFxuICAgICAgLyptZXRob2ROYW1lKi8gJ3dyaXRlRmlsZScsXG4gICAgICAvKm1ldGhvZEFyZ3MqLyBbcGF0aCwgb3B0aW9uc10sXG4gICAgICAvKmV4dHJhT3B0aW9ucyovIHtib2R5OiBkYXRhLCBtZXRob2Q6ICdQT1NUJ31cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcsIGVtcHR5IGZpbGUgb24gdGhlIHJlbW90ZSBGUy5cbiAgICpcbiAgICogSWYgbm8gZmlsZSAob3IgZGlyZWN0b3J5KSBhdCB0aGUgc3BlY2lmaWVkIHBhdGggZXhpc3RzLCBjcmVhdGVzIHRoZSBwYXJlbnRcbiAgICogZGlyZWN0b3JpZXMgKGlmIG5lY2Vzc2FyeSkgYW5kIHRoZW4gd3JpdGVzIGFuIGVtcHR5IGZpbGUgYXQgdGhlIHNwZWNpZmllZFxuICAgKiBwYXRoLlxuICAgKlxuICAgKiBAcmV0dXJuIEEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgdGhlIGZpbGUgd2FzIGNyZWF0ZWQuXG4gICAqL1xuICBuZXdGaWxlKHBhdGg6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHJldHVybiB0aGlzLmV2ZW50YnVzLmNhbGxNZXRob2QoXG4gICAgICAvKnNlcnZpY2VOYW1lKi8gJ2ZzJyxcbiAgICAgIC8qbWV0aG9kTmFtZSovICduZXdGaWxlJyxcbiAgICAgIC8qbWV0aG9kQXJncyovIFtwYXRoXSxcbiAgICAgIC8qZXh0cmFPcHRpb25zKi8ge21ldGhvZDogJ1BPU1QnLCBqc29uOiB0cnVlfVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhbiBmcy5TdGF0cyBwcm9taXNlIGZyb20gcmVtb3RlIEZTXG4gICAqXG4gICAqIEBwYXJhbSBwYXRoIHRoZSBwYXRoIHRvIHRoZSBmaWxlL2RpcmVjdG9yeSB0byBnZXQgU3RhdHMgZm9yXG4gICAqL1xuICBhc3luYyBzdGF0KHBhdGg6IHN0cmluZyk6IFByb21pc2U8ZnMuU3RhdHM+IHtcbiAgICB2YXIgYm9keSA9IGF3YWl0IHRoaXMuZXZlbnRidXMuY2FsbE1ldGhvZChcbiAgICAgIC8qc2VydmljZU5hbWUqLyAnZnMnLFxuICAgICAgLyptZXRob2ROYW1lKi8gJ3N0YXQnLFxuICAgICAgLyptZXRob2RBcmdzKi8gW3BhdGhdLFxuICAgICAgLypleHRyYU9wdGlvbnMqLyB7anNvbjogdHJ1ZX1cbiAgICApO1xuICAgIHJldHVybiBjcmVhdGVTdGF0cyhib2R5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgcHJvbWlzbSB0aGF0IHJlc29sdmVzIHRvIGFuIGFycmF5IG9mXG4gICAqIHtmaWxlOiAnbmFtZScsIHN0YXRzOiA8ZnMuU3RhdHM+fSBmcm9tIHJlbW90ZSBGU1xuICAgKlxuICAgKiBAcGFyYW0gcGF0aCB0aGUgcGF0aCB0byB0aGUgZGlyZWN0b3J5IHRvIGdldCBlbnRyaWVzIGZvclxuICAgKi9cbiAgYXN5bmMgcmVhZGRpcihwYXRoOiBzdHJpbmcpOiBQcm9taXNlPEFycmF5PEZpbGVXaXRoU3RhdHM+PiB7XG4gICAgdmFyIGJvZHkgPSBhd2FpdCB0aGlzLmV2ZW50YnVzLmNhbGxNZXRob2QoXG4gICAgICAvKnNlcnZpY2VOYW1lKi8gJ2ZzJyxcbiAgICAgIC8qbWV0aG9kTmFtZSovICdyZWFkZGlyJyxcbiAgICAgIC8qbWV0aG9kQXJncyovIFtwYXRoXSxcbiAgICAgIC8qZXh0cmFPcHRpb25zKi8ge2pzb246IHRydWV9XG4gICAgKTtcbiAgICByZXR1cm4gYm9keS5tYXAoKGVudHJ5KSA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBmaWxlOiBlbnRyeS5maWxlLFxuICAgICAgICBzdGF0czogY3JlYXRlU3RhdHMoZW50cnkuc3RhdHMpLFxuICAgICAgICBpc1N5bWJvbGljTGluazogZW50cnkuaXNTeW1ib2xpY0xpbmssXG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYW4gZnMuU3RhdHMgcHJvbWlzZSBmcm9tIHJlbW90ZSBGU1xuICAgKlxuICAgKiBAcGFyYW0gcGF0aCB0aGUgcGF0aCB0byB0aGUgZmlsZS9kaXJlY3RvcnkgdG8gZ2V0IFN0YXRzIGZvclxuICAgKlxuICAgKiBTYW1lIGFzIHN0YXRzIGNhbGwgYWJvdmUgZXhjZXB0IGl0IHdpbGwgcmV0dXJuIHRoZSBzdGF0cyBmb3IgdGhlXG4gICAqIHVuZGVybHlpbmcgZmlsZSBpZiBhIGxpbmsgaXMgcGFzc2VkLlxuICAgKi9cbiAgYXN5bmMgbHN0YXQocGF0aDogc3RyaW5nKTogUHJvbWlzZTxmcy5TdGF0cz4ge1xuICAgIHZhciBib2R5ID0gYXdhaXQgdGhpcy5ldmVudGJ1cy5jYWxsTWV0aG9kKFxuICAgICAgLypzZXJ2aWNlTmFtZSovICdmcycsXG4gICAgICAvKm1ldGhvZE5hbWUqLyAnbHN0YXQnLFxuICAgICAgLyptZXRob2RBcmdzKi8gW3BhdGhdLFxuICAgICAgLypleHRyYU9wdGlvbnMqLyB7anNvbjogdHJ1ZX1cbiAgICApO1xuICAgIHJldHVybiBjcmVhdGVTdGF0cyhib2R5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVja3MgZm9yIGV4aXN0ZW5jZSBvZiBhIGZpbGUvZGlyZWN0b3J5L2xpbmsgb24gYSByZW1vdGUgRlNcbiAgICpcbiAgICogQHBhcmFtIHBhdGggdGhlIHBhdGggdG8gdGhlIGZpbGUvZGlyZWN0b3J5IHRvIGNoZWNrIGZvciBleGlzdGVuY2VcbiAgICpcbiAgICogSXQgcmV0dXJucyBwcm9taXNlIHRoYXQgcmVzb2x2ZSB0byB0cnVlIGlmIGZpbGUgZXhpc3RzLCBmYWxzZSBvdGhlcndpc2UuXG4gICAqL1xuICBleGlzdHMocGF0aDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRidXMuY2FsbE1ldGhvZChcbiAgICAgIC8qc2VydmljZU5hbWUqLyAnZnMnLFxuICAgICAgLyptZXRob2ROYW1lKi8gJ2V4aXN0cycsXG4gICAgICAvKm1ldGhvZEFyZ3MqLyBbcGF0aF0sXG4gICAgICAvKmV4dHJhT3B0aW9ucyovIHtqc29uOiB0cnVlfVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgcmVhbCBwYXRoIG9mIGEgZmlsZSBwYXRoLlxuICAgKiBJdCBjb3VsZCBiZSBkaWZmZXJlbnQgdGhhbiB0aGUgZ2l2ZW4gcGF0aCBpZiB0aGUgZmlsZSBpcyBhIHN5bWxpbmtcbiAgICogb3IgZXhpc3RzIGluIGEgc3ltbGlua2VkIGRpcmVjdG9yeS5cbiAgICovXG4gIHJlYWxwYXRoKHBhdGg6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRidXMuY2FsbE1ldGhvZChcbiAgICAgIC8qc2VydmljZU5hbWUqLyAnZnMnLFxuICAgICAgLyptZXRob2ROYW1lKi8gJ3JlYWxwYXRoJyxcbiAgICAgIC8qbWV0aG9kQXJncyovIFtwYXRoXVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogUmVuYW1lIGEgZmlsZSBvciBmb2xkZXIuXG4gICAqL1xuICByZW5hbWUoc291cmNlUGF0aDogc3RyaW5nLCBkZXN0aW5hdGlvblBhdGg6IHN0cmluZyk6IFByb21pc2Uge1xuICAgIHJldHVybiB0aGlzLmV2ZW50YnVzLmNhbGxNZXRob2QoXG4gICAgICAvKnNlcnZpY2VOYW1lKi8gJ2ZzJyxcbiAgICAgIC8qbWV0aG9kTmFtZSovICdyZW5hbWUnLFxuICAgICAgLyptZXRob2RBcmdzKi8gW3NvdXJjZVBhdGgsIGRlc3RpbmF0aW9uUGF0aF0sXG4gICAgICAvKmV4dHJhT3B0aW9ucyovIHttZXRob2Q6ICdQT1NUJ31cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcgZGlyZWN0b3J5IHdpdGggdGhlIGdpdmVuIHBhdGguXG4gICAqIFRocm93cyBFRVhJU1QgZXJyb3IgaWYgdGhlIGRpcmVjdG9yeSBhbHJlYWR5IGV4aXN0cy5cbiAgICogVGhyb3dzIEVOT0VOVCBpZiB0aGUgcGF0aCBnaXZlbiBpcyBuZXN0ZWQgaW4gYSBub24tZXhpc3RpbmcgZGlyZWN0b3J5LlxuICAgKi9cbiAgbWtkaXIocGF0aDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICByZXR1cm4gdGhpcy5ldmVudGJ1cy5jYWxsTWV0aG9kKFxuICAgICAgLypzZXJ2aWNlTmFtZSovICdmcycsXG4gICAgICAvKm1ldGhvZE5hbWUqLyAnbWtkaXInLFxuICAgICAgLyptZXRob2RBcmdzKi8gW3BhdGhdLFxuICAgICAgLypleHRyYU9wdGlvbnMqLyB7bWV0aG9kOiAnUE9TVCd9XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSdW5zIHRoZSBlcXVpdmFsZW50IG9mIGBta2RpciAtcGAgd2l0aCB0aGUgZ2l2ZW4gcGF0aC5cbiAgICpcbiAgICogTGlrZSBtb3N0IGltcGxlbWVudGF0aW9ucyBvZiBta2RpcnAsIGlmIGl0IGZhaWxzLCBpdCBpcyBwb3NzaWJsZSB0aGF0XG4gICAqIGRpcmVjdG9yaWVzIHdlcmUgY3JlYXRlZCBmb3Igc29tZSBwcmVmaXggb2YgdGhlIGdpdmVuIHBhdGguXG4gICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgcGF0aCB3YXMgY3JlYXRlZDsgZmFsc2UgaWYgaXQgYWxyZWFkeSBleGlzdGVkLlxuICAgKi9cbiAgbWtkaXJwKHBhdGg6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHJldHVybiB0aGlzLmV2ZW50YnVzLmNhbGxNZXRob2QoXG4gICAgICAvKnNlcnZpY2VOYW1lKi8gJ2ZzJyxcbiAgICAgIC8qbWV0aG9kTmFtZSovICdta2RpcnAnLFxuICAgICAgLyptZXRob2RBcmdzKi8gW3BhdGhdLFxuICAgICAgLypleHRyYU9wdGlvbnMqLyB7bWV0aG9kOiAnUE9TVCcsIGpzb246IHRydWV9XG4gICAgKTtcbiAgfVxuXG4gIC8qXG4gICAqIFJlbW92ZXMgZGlyZWN0b3JpZXMgZXZlbiBpZiB0aGV5IGFyZSBub24tZW1wdHkuIERvZXMgbm90IGZhaWwgaWYgdGhlIGRpcmVjdG9yeSBkb2Vzbid0IGV4aXN0LlxuICAgKi9cbiAgcm1kaXIocGF0aDogc3RyaW5nKTogUHJvbWlzZSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRidXMuY2FsbE1ldGhvZChcbiAgICAgIC8qc2VydmljZU5hbWUqLyAnZnMnLFxuICAgICAgLyptZXRob2ROYW1lKi8gJ3JtZGlyJyxcbiAgICAgIC8qbWV0aG9kQXJncyovIFtwYXRoXSxcbiAgICAgIC8qZXh0cmFPcHRpb25zKi8ge21ldGhvZDogJ1BPU1QnLCBqc29uOiB0cnVlfVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlcyBmaWxlcy4gRG9lcyBub3QgZmFpbCBpZiB0aGUgZmlsZSBkb2Vzbid0IGV4aXN0LlxuICAgKi9cbiAgdW5saW5rKHBhdGg6IHN0cmluZyk6IFByb21pc2Uge1xuICAgIHJldHVybiB0aGlzLmV2ZW50YnVzLmNhbGxNZXRob2QoXG4gICAgICAvKnNlcnZpY2VOYW1lKi8gJ2ZzJyxcbiAgICAgIC8qbWV0aG9kTmFtZSovICd1bmxpbmsnLFxuICAgICAgLyptZXRob2RBcmdzKi8gW3BhdGhdLFxuICAgICAgLypleHRyYU9wdGlvbnMqLyB7bWV0aG9kOiAnUE9TVCcsIGpzb246IHRydWV9XG4gICAgKTtcbiAgfVxuXG4gIGZpbmROZWFyZXN0RmlsZShmaWxlTmFtZTogc3RyaW5nLCBwYXRoVG9EaXJlY3Rvcnk6IHN0cmluZyk6IFByb21pc2U8P3N0cmluZz4ge1xuICAgIHJldHVybiB0aGlzLmV2ZW50YnVzLmNhbGxNZXRob2QoXG4gICAgICAvKnNlcnZpY2VOYW1lKi8gJ2ZzJyxcbiAgICAgIC8qbWV0aG9kTmFtZSovICdmaW5kTmVhcmVzdEZpbGUnLFxuICAgICAgLyptZXRob2RBcmdzKi8gW2ZpbGVOYW1lLCBwYXRoVG9EaXJlY3RvcnldLFxuICAgICAgLypleHRyYU9wdGlvbnMqLyB7anNvbjogdHJ1ZX1cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIE1ha2UgcnBjIGNhbGwgdG8gc2VydmljZSBnaXZlbiBzZXJ2aWNlVXJpIGluIGZvcm0gb2YgYCRzZXJ2aWNlTmFtZS8kbWV0aG9kTmFtZWAgYW5kIGFyZ3MgYXMgYXJndW1lbnRzIGxpc3QuXG4gICAqL1xuICBtYWtlUnBjKHNlcnZpY2VVcmk6IHN0cmluZywgYXJnczogQXJyYXk8YW55Piwgc2VydmljZU9wdGlvbnM6IGFueSk6IFByb21pc2U8YW55PiB7XG4gICAgdmFyIFtzZXJ2aWNlTmFtZSwgbWV0aG9kTmFtZV0gPSBzZXJ2aWNlVXJpLnNwbGl0KCcvJyk7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRidXMuY2FsbFNlcnZpY2VGcmFtZXdvcmtNZXRob2QoXG4gICAgICBzZXJ2aWNlTmFtZSxcbiAgICAgIG1ldGhvZE5hbWUsXG4gICAgICAvKiBtZXRob2RBcmdzICovIGFyZ3MsXG4gICAgICAvKiBzZXJ2aWNlT3B0aW9ucyAqLyBzZXJ2aWNlT3B0aW9uc1xuICAgKTtcbiAgfVxuXG4gIHJlZ2lzdGVyRXZlbnRMaXN0ZW5lcihldmVudE5hbWU6IHN0cmluZywgY2FsbGJhY2s6ICguLi5hcmdzOiBBcnJheTxhbnk+KSA9PiB2b2lkLCBzZXJ2aWNlT3B0aW9uczogYW55KTogRGlzcG9zYWJsZSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRidXMucmVnaXN0ZXJFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgY2FsbGJhY2ssIHNlcnZpY2VPcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZWFyY2hlcyB0aGUgY29udGVudHMgb2YgYGRpcmVjdG9yeWAgZm9yIHBhdGhzIG1hdGhpbmcgYHF1ZXJ5YC5cbiAgICovXG4gIGFzeW5jIHNlYXJjaERpcmVjdG9yeShkaXJlY3Rvcnk6IHN0cmluZywgcXVlcnk6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZXZlbnRidXMuY2FsbE1ldGhvZChcbiAgICAgIC8qc2VydmljZU5hbWUqLyAnc2VhcmNoJyxcbiAgICAgIC8qbWV0aG9kTmFtZSovICdkaXJlY3RvcnknLFxuICAgICAgLyptZXRob2RBcmdzKi8gW2RpcmVjdG9yeSwgcXVlcnldLFxuICAgICAgLypleHRyYU9wdGlvbnMqLyB7anNvbjogdHJ1ZX1cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIHNlcnZlciB2ZXJzaW9uLlxuICAgKi9cbiAgdmVyc2lvbigpOiBQcm9taXNlPG51bWJlcnxzdHJpbmc+IHtcbiAgICByZXR1cm4gdGhpcy5ldmVudGJ1cy5jYWxsTWV0aG9kKFxuICAgICAgLypzZXJ2aWNlTmFtZSovICdzZXJ2ZXInLFxuICAgICAgLyptZXRob2ROYW1lKi8gJ3ZlcnNpb24nLFxuICAgICAgLyptZXRob2RBcmdzKi8gW10sXG4gICAgICAvKmV4dHJhT3B0aW9ucyovIHttZXRob2Q6ICdQT1NUJywganNvbjogdHJ1ZX1cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIHNlcnZlciB2ZXJzaW9uLlxuICAgKi9cbiAgc2h1dGRvd25TZXJ2ZXIoKTogUHJvbWlzZSB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRidXMuY2FsbE1ldGhvZChcbiAgICAgIC8qc2VydmljZU5hbWUqLyAnc2VydmVyJyxcbiAgICAgIC8qbWV0aG9kTmFtZSovICdzaHV0ZG93bicsXG4gICAgICAvKm1ldGhvZEFyZ3MqLyBbXSxcbiAgICAgIC8qZXh0cmFPcHRpb25zKi8ge21ldGhvZDogJ1BPU1QnfVxuICAgICk7XG4gIH1cblxuICBhc3luYyB3YXRjaEZpbGUoZmlsZVBhdGg6IHN0cmluZyk6IFByb21pc2U8RnNXYXRjaGVyPiB7XG4gICAgdmFyIHdhdGNoZXJJZCA9IGF3YWl0IHRoaXMuZXZlbnRidXMuY2FsbE1ldGhvZChcbiAgICAgIC8qc2VydmljZU5hbWUqLyAnd2F0Y2hlcicsXG4gICAgICAvKm1ldGhvZE5hbWUqLyAnd2F0Y2hGaWxlJyxcbiAgICAgIC8qbWV0aG9kQXJncyovIFtmaWxlUGF0aF0sXG4gICAgICAvKmV4dHJhT3B0aW9ucyovIHttZXRob2Q6ICdQT1NUJywganNvbjogdHJ1ZX1cbiAgICApO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmV2ZW50YnVzLmNvbnN1bWVFdmVudEVtaXR0ZXIod2F0Y2hlcklkLCBbJ2NoYW5nZScsICdyZW5hbWUnLCAnZGVsZXRlJ10pO1xuICB9XG5cbiAgYXN5bmMgd2F0Y2hEaXJlY3RvcnkoZGlyZWN0b3J5UGF0aDogc3RyaW5nKTogUHJvbWlzZTxGc1dhdGNoZXI+IHtcbiAgICB2YXIgd2F0Y2hlcklkID0gYXdhaXQgdGhpcy5ldmVudGJ1cy5jYWxsTWV0aG9kKFxuICAgICAgLypzZXJ2aWNlTmFtZSovICd3YXRjaGVyJyxcbiAgICAgIC8qbWV0aG9kTmFtZSovICd3YXRjaERpcmVjdG9yeScsXG4gICAgICAvKm1ldGhvZEFyZ3MqLyBbZGlyZWN0b3J5UGF0aF0sXG4gICAgICAvKmV4dHJhT3B0aW9ucyovIHttZXRob2Q6ICdQT1NUJywganNvbjogdHJ1ZX1cbiAgICApO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmV2ZW50YnVzLmNvbnN1bWVFdmVudEVtaXR0ZXIod2F0Y2hlcklkLCBbJ2NoYW5nZSddKTtcbiAgfVxuXG4gIGFzeW5jIHdhdGNoRGlyZWN0b3J5UmVjdXJzaXZlKGRpcmVjdG9yeVBhdGg6IHN0cmluZywgaGFuZGxlcjogKG51bWJlck9mQ2hhbmdlczogbnVtYmVyKSA9PiB2b2lkKSB7XG4gICAgdmFyIHdhdGNoQ2hhbm5lbCA9IHdhdGNoRGlyZWN0b3J5Q2hhbm5lbChkaXJlY3RvcnlQYXRoKTtcbiAgICBhd2FpdCB0aGlzLmV2ZW50YnVzLnN1YnNjcmliZVRvQ2hhbm5lbCh3YXRjaENoYW5uZWwsIGhhbmRsZXIpO1xuICAgIGF3YWl0IHRoaXMuZXZlbnRidXMuY2FsbE1ldGhvZChcbiAgICAgIC8qc2VydmljZU5hbWUqLyAnd2F0Y2hlcicsXG4gICAgICAvKm1ldGhvZE5hbWUqLyAnd2F0Y2hEaXJlY3RvcnlSZWN1cnNpdmUnLFxuICAgICAgLyptZXRob2RBcmdzKi8gW2RpcmVjdG9yeVBhdGgsIHdhdGNoQ2hhbm5lbF0sXG4gICAgICAvKmV4dHJhT3B0aW9ucyovIHttZXRob2Q6ICdQT1NUJywganNvbjogdHJ1ZX1cbiAgICApO1xuICB9XG5cbiAgdW53YXRjaEZpbGUoZmlsZVBhdGg6IHN0cmluZyk6IFByb21pc2Uge1xuICAgIHJldHVybiB0aGlzLmV2ZW50YnVzLmNhbGxNZXRob2QoXG4gICAgICAvKnNlcnZpY2VOYW1lKi8gJ3dhdGNoZXInLFxuICAgICAgLyptZXRob2ROYW1lKi8gJ3Vud2F0Y2hGaWxlJyxcbiAgICAgIC8qbWV0aG9kQXJncyovIFtmaWxlUGF0aF0sXG4gICAgICAvKmV4dHJhT3B0aW9ucyovIHttZXRob2Q6ICdQT1NUJywganNvbjogdHJ1ZX1cbiAgICApO1xuICB9XG5cbiAgdW53YXRjaERpcmVjdG9yeShkaXJlY3RvcnlQYXRoOiBzdHJpbmcpOiBQcm9taXNlIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudGJ1cy5jYWxsTWV0aG9kKFxuICAgICAgLypzZXJ2aWNlTmFtZSovICd3YXRjaGVyJyxcbiAgICAgIC8qbWV0aG9kTmFtZSovICd1bndhdGNoRGlyZWN0b3J5JyxcbiAgICAgIC8qbWV0aG9kQXJncyovIFtkaXJlY3RvcnlQYXRoXSxcbiAgICAgIC8qZXh0cmFPcHRpb25zKi8ge21ldGhvZDogJ1BPU1QnLCBqc29uOiB0cnVlfVxuICAgICk7XG4gIH1cblxuICB1bndhdGNoRGlyZWN0b3J5UmVjdXJzaXZlKGRpcmVjdG9yeVBhdGg6IHN0cmluZyk6IFByb21pc2Uge1xuICAgIHJldHVybiB0aGlzLmV2ZW50YnVzLmNhbGxNZXRob2QoXG4gICAgICAvKnNlcnZpY2VOYW1lKi8gJ3dhdGNoZXInLFxuICAgICAgLyptZXRob2ROYW1lKi8gJ3Vud2F0Y2hEaXJlY3RvcnlSZWN1cnNpdmUnLFxuICAgICAgLyptZXRob2RBcmdzKi8gW2RpcmVjdG9yeVBhdGhdLFxuICAgICAgLypleHRyYU9wdGlvbnMqLyB7bWV0aG9kOiAnUE9TVCcsIGpzb246IHRydWV9XG4gICAgKTtcbiAgfVxuXG4gIGRvU2VhcmNoUXVlcnkocm9vdERpcmVjdG9yeTpzdHJpbmcsIHByb3ZpZGVyOiBzdHJpbmcsIHF1ZXJ5OiBzdHJpbmcpOiBQcm9taXNlIHtcbiAgICByZXR1cm4gdGhpcy5ldmVudGJ1cy5jYWxsTWV0aG9kKFxuICAgICAgLypzZXJ2aWNlTmFtZSovICdzZWFyY2gnLFxuICAgICAgLyptZXRob2ROYW1lKi8gJ3F1ZXJ5JyxcbiAgICAgIC8qbWV0aG9kQXJncyovIFtyb290RGlyZWN0b3J5LCBwcm92aWRlciwgcXVlcnldLFxuICAgICAgLypleHRyYU9wdGlvbnMqLyB7bWV0aG9kOiAnUE9TVCcsIGpzb246IHRydWV9XG4gICAgKTtcbiAgfVxuXG4gIGFzeW5jIGdldFNlYXJjaFByb3ZpZGVycyhyb290RGlyZWN0b3J5OiBzdHJpbmcpOiBQcm9taXNlPEFycmF5PHtuYW1lOnN0cmluZ30+PiB7XG4gICAgdmFyIHByb3ZpZGVycyA9IHRoaXMuX3NlYXJjaFByb3ZpZGVyc1tyb290RGlyZWN0b3J5XTtcbiAgICBpZiAocHJvdmlkZXJzKSB7XG4gICAgICByZXR1cm4gcHJvdmlkZXJzO1xuICAgIH1cbiAgICBwcm92aWRlcnMgPSBhd2FpdCB0aGlzLmV2ZW50YnVzLmNhbGxNZXRob2QoXG4gICAgICAvKnNlcnZpY2VOYW1lKi8gJ3NlYXJjaCcsXG4gICAgICAvKm1ldGhvZE5hbWUqLyAnbGlzdFByb3ZpZGVycycsXG4gICAgICAvKm1ldGhvZEFyZ3MqLyBbcm9vdERpcmVjdG9yeV0sXG4gICAgICAvKmV4dHJhT3B0aW9ucyovIHttZXRob2Q6ICdQT1NUJywganNvbjogdHJ1ZX1cbiAgICApO1xuXG4gICAgdGhpcy5fc2VhcmNoUHJvdmlkZXJzW3Jvb3REaXJlY3RvcnldID0gcHJvdmlkZXJzO1xuXG4gICAgcmV0dXJuIHByb3ZpZGVycztcbiAgfVxuXG4gIGdldEhhY2tEaWFnbm9zdGljcygpOiBQcm9taXNlIHtcbiAgICB2YXIge2N3ZH0gPSB0aGlzLl9vcHRpb25zO1xuICAgIHJldHVybiB0aGlzLmV2ZW50YnVzLmNhbGxNZXRob2QoXG4gICAgICAvKnNlcnZpY2VOYW1lKi8gJ2hhY2snLFxuICAgICAgLyptZXRob2ROYW1lKi8gJ2dldERpYWdub3N0aWNzJyxcbiAgICAgIC8qbWV0aG9kQXJncyovIFt7Y3dkfV0sXG4gICAgICAvKmV4dHJhT3B0aW9ucyovIHttZXRob2Q6ICdQT1NUJywganNvbjogdHJ1ZX1cbiAgICApO1xuICB9XG5cbiAgZ2V0SGFja0NvbXBsZXRpb25zKHF1ZXJ5OiBzdHJpbmcpOiBQcm9taXNlIHtcbiAgICB2YXIge2N3ZH0gPSB0aGlzLl9vcHRpb25zO1xuICAgIHJldHVybiB0aGlzLmV2ZW50YnVzLmNhbGxNZXRob2QoXG4gICAgICAvKnNlcnZpY2VOYW1lKi8gJ2hhY2snLFxuICAgICAgLyptZXRob2ROYW1lKi8gJ2dldENvbXBsZXRpb25zJyxcbiAgICAgIC8qbWV0aG9kQXJncyovIFtxdWVyeSwge2N3ZH1dLFxuICAgICAgLypleHRyYU9wdGlvbnMqLyB7bWV0aG9kOiAnUE9TVCcsIGpzb246IHRydWV9XG4gICAgKTtcbiAgfVxuXG4gIGdldEhhY2tEZWZpbml0aW9uKHF1ZXJ5OiBzdHJpbmcsIHN5bWJvbFR5cGU6IFN5bWJvbFR5cGUpOiBQcm9taXNlIHtcbiAgICB2YXIge2N3ZH0gPSB0aGlzLl9vcHRpb25zO1xuICAgIHJldHVybiB0aGlzLmV2ZW50YnVzLmNhbGxNZXRob2QoXG4gICAgICAvKnNlcnZpY2VOYW1lKi8gJ2hhY2snLFxuICAgICAgLyptZXRob2ROYW1lKi8gJ2dldERlZmluaXRpb24nLFxuICAgICAgLyptZXRob2RBcmdzKi8gW3F1ZXJ5LCBzeW1ib2xUeXBlLCB7Y3dkfV0sXG4gICAgICAvKmV4dHJhT3B0aW9ucyovIHttZXRob2Q6ICdQT1NUJywganNvbjogdHJ1ZX1cbiAgICApO1xuICB9XG5cbiAgZ2V0SGFja0RlcGVuZGVuY2llcyhkZXBlbmRlbmNpZXNJbmZvOiBBcnJheTx7bmFtZTogc3RyaW5nOyB0eXBlOiBzdHJpbmd9Pik6IFByb21pc2U8YW55PiB7XG4gICAgdmFyIHtjd2R9ID0gdGhpcy5fb3B0aW9ucztcbiAgICByZXR1cm4gdGhpcy5ldmVudGJ1cy5jYWxsTWV0aG9kKFxuICAgICAgLypzZXJ2aWNlTmFtZSovICdoYWNrJyxcbiAgICAgIC8qbWV0aG9kTmFtZSovICdnZXREZXBlbmRlbmNpZXMnLFxuICAgICAgLyptZXRob2RBcmdzKi8gW2RlcGVuZGVuY2llc0luZm8sIHtjd2R9XSxcbiAgICAgIC8qZXh0cmFPcHRpb25zKi8ge21ldGhvZDogJ1BPU1QnLCBqc29uOiB0cnVlfVxuICAgICk7XG4gIH1cblxuICBnZXRIYWNrU2VhcmNoUmVzdWx0cyhcbiAgICAgIHNlYXJjaDogc3RyaW5nLFxuICAgICAgZmlsdGVyVHlwZXM6ID9BcnJheTxTZWFyY2hSZXN1bHRUeXBlPixcbiAgICAgIHNlYXJjaFBvc3RmaXg6ID9zdHJpbmcpOiBQcm9taXNlIHtcbiAgICB2YXIge2N3ZH0gPSB0aGlzLl9vcHRpb25zO1xuICAgIHJldHVybiB0aGlzLmV2ZW50YnVzLmNhbGxNZXRob2QoXG4gICAgICAvKnNlcnZpY2VOYW1lKi8gJ2hhY2snLFxuICAgICAgLyptZXRob2ROYW1lKi8gJ2dldFNlYXJjaFJlc3VsdHMnLFxuICAgICAgLyptZXRob2RBcmdzKi8gW3NlYXJjaCwgZmlsdGVyVHlwZXMsIHNlYXJjaFBvc3RmaXgsIHtjd2R9XSxcbiAgICAgIC8qZXh0cmFPcHRpb25zKi8ge21ldGhvZDogJ1BPU1QnLCBqc29uOiB0cnVlfVxuICAgICk7XG4gIH1cblxuICBnZXRIYWNrUmVmZXJlbmNlcyhxdWVyeTogc3RyaW5nKTogUHJvbWlzZTxBcnJheTxIYWNrUmVmZXJlbmNlPj4ge1xuICAgIHZhciB7Y3dkfSA9IHRoaXMuX29wdGlvbnM7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRidXMuY2FsbE1ldGhvZChcbiAgICAgIC8qc2VydmljZU5hbWUqLyAnaGFjaycsXG4gICAgICAvKm1ldGhvZE5hbWUqLyAnZ2V0UmVmZXJlbmNlcycsXG4gICAgICAvKm1ldGhvZEFyZ3MqLyBbcXVlcnksIHtjd2R9XSxcbiAgICAgIC8qZXh0cmFPcHRpb25zKi8ge21ldGhvZDogJ1BPU1QnLCBqc29uOiB0cnVlfVxuICAgICk7XG4gIH1cblxuICBpc0hhY2tDbGllbnRBdmFpbGFibGUoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRidXMuY2FsbE1ldGhvZChcbiAgICAgIC8qc2VydmljZU5hbWUqLyAnaGFjaycsXG4gICAgICAvKm1ldGhvZE5hbWUqLyAnaXNDbGllbnRBdmFpbGFibGUnLFxuICAgICAgLyptZXRob2RBcmdzKi8gW10sXG4gICAgICAvKmV4dHJhT3B0aW9ucyovIHttZXRob2Q6ICdQT1NUJywganNvbjogdHJ1ZX1cbiAgICApO1xuICB9XG5cbiAgY2xvc2UoKSA6IHZvaWQge1xuICAgIGlmICh0aGlzLmV2ZW50YnVzKSB7XG4gICAgICB0aGlzLmV2ZW50YnVzLmNsb3NlKCk7XG4gICAgICB0aGlzLmV2ZW50YnVzID0gbnVsbDtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gY3JlYXRlU3RhdHMoanNvblN0YXRzOiBhbnkpIHtcbiAgdmFyIHN0YXRzID0gbmV3IGZzLlN0YXRzKCk7XG5cbiAgc3RhdHMuZGV2ID0ganNvblN0YXRzLmRldjtcbiAgc3RhdHMubW9kZSA9IGpzb25TdGF0cy5tb2RlO1xuICBzdGF0cy5ubGluayA9IGpzb25TdGF0cy5ubGluaztcbiAgc3RhdHMudWlkID0ganNvblN0YXRzLnVpZDtcbiAgc3RhdHMuZ2lkID0ganNvblN0YXRzLmdpZDtcbiAgc3RhdHMucmRldiA9IGpzb25TdGF0cy5yZGV2O1xuICBzdGF0cy5ibGtzaXplID0ganNvblN0YXRzLmJsa3NpemU7XG4gIHN0YXRzLmlubyA9IGpzb25TdGF0cy5pbm87XG4gIHN0YXRzLnNpemUgPSBqc29uU3RhdHMuc2l6ZTtcbiAgc3RhdHMuYmxvY2tzID0ganNvblN0YXRzLmJsb2NrcztcbiAgc3RhdHMuYXRpbWUgPSBuZXcgRGF0ZShqc29uU3RhdHMuYXRpbWUpO1xuICBzdGF0cy5tdGltZSA9IG5ldyBEYXRlKGpzb25TdGF0cy5tdGltZSk7XG4gIHN0YXRzLmN0aW1lID0gbmV3IERhdGUoanNvblN0YXRzLmN0aW1lKTtcblxuICBpZiAoanNvblN0YXRzLmJpcnRodGltZSkge1xuICAgIHN0YXRzLmJpcnRodGltZSA9IG5ldyBEYXRlKGpzb25TdGF0cy5iaXJ0aHRpbWUpO1xuICB9XG5cbiAgcmV0dXJuIHN0YXRzO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IE51Y2xpZGVDbGllbnQ7XG5cbmZ1bmN0aW9uIHdhdGNoRGlyZWN0b3J5Q2hhbm5lbChkaXJlY3RvcnlQYXRoOiBzdHJpbmcpIHtcbiAgcmV0dXJuICd3YXRjaCcgKyBkaXJlY3RvcnlQYXRoO1xufVxuIl19
